/*! mowgli-core 2016-04-19 */
"use strict";function CPKColorer(){this.name="CPK"}function ChainColorer(){this.name="Chain"}function ShaderCompilationException(a){this.value=a,this.message="cannot compile the shader source",this.toString=function(){return this.value+this.message}}function ShaderLinkException(a){this.value=a,this.message="cannot compile the shader source",this.toString=function(){return this.value+this.message}}function PointGeometer(a,b){console.log("PointGeometer"),this.mol=a,this.colorer=b||CPKColorer,this.shape}function WireGeometer(a,b){this.mol=a,this.colorer=b||CPKColorer,this.shape}function Renderer(a){function b(a,b){var c=["webgl","experimental-webgl"],d=null;for(var e in c){try{d=a.getContext(c[e],b)}catch(f){}if(d)break}return d}this.scene=null;var c=document.getElementById(a);if(this.context=b(c),this.context){var d=c.clientWidth,e=c.clientHeight;(c.width!=d||c.height!=e)&&(c.width=d,c.height=e),this.context.viewportWidth=c.width,this.context.viewportHeight=c.height,this.shaders=[],this.shaderProgram=null,this._initGL()}}function NodeGL(a){this.sgnode=a,this.glType=-1,this._isDirty=!0,this.workmatrix=mat4.create(),mat4.identity(this.workmatrix)}function ShapeGL(a){NodeGL.call(this,a),this.numIndices=0,this.numItems=0,this.VBOs=[],this.GLTextures=[],this.shaderProgram=null}function Attribute(a,b,c){this.name=a,this.offset=b,this.stride=c,this.size=-1,this.location=-1}function Program(a,b){this.ctx=a,this.name=b,this.vertex_shader=null,this.fragment_shader=null,this.shaderProgram=0,this.attributes=[],this.uniforms=[],this.attribLocation={},this.uniformLocation={}}function Uniform(a){this.name=a.name}function Cube(){mwSG.Shape.call(this),this.ID="cube"}function EMDBInfoParser(){}function ImageParser(){this.raster=new Raster({})}function MMCIFParser(){}function PDBMLParser(){}function PDBParser(){this.mol=new Molecule({}),this.secondary=[],this.cubes=[],this.cube_side=5}function XYZParser(){this.mol=new Molecule({})}function IsoCube(a,b,c,d){this.x=a,this.y=b,this.z=c,this.size=d,this.voxels=[],this.edges=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.key=0}function IsoSlice(a,b){this.cubes=[],this.count=0,this.w=a,this.h=b}function IsoSurfacer(a){a instanceof Raster?(this.map=a,this.mesh={},this.mesh.vertices=[],this.mesh.faces=[],this.threshold=128,this.cubeSize=2,this.interpolate=function(a,b){var c=(a.x+b.x)/2,d=(a.y+b.y)/2,e=(a.z+b.z)/2;return{x:c,y:d,z:e}}):MOWGLI.alert("This structure is not a raster/map")}function Atom(){this.type,this.serial,this.name,this.altLoc,this.group,this.groupID,this.chain,this.x,this.y,this.z,this.symbol}function Bond(a,b){this.type=Bond.NONE,this.atom1=a,this.atom2=b,this.middle={x:(this.atom1.x+this.atom2.x)/2,y:(this.atom1.y+this.atom2.y)/2,z:(this.atom1.z+this.atom2.z)/2}}function BondCalculator(a){function b(a){var b=5;g=Math.round((a.bbox.max.x-a.bbox.min.x)/b),h=Math.round((a.bbox.max.y-a.bbox.min.y)/b),i=Math.round((a.bbox.max.z-a.bbox.min.z)/b);for(var c in a.atoms){var d=a.atoms[c],e=Math.floor((d.x-a.bbox.min.x)/b),j=Math.floor((d.y-a.bbox.min.y)/b),k=Math.floor((d.z-a.bbox.min.z)/b),l=e+j*g+k*g*h;void 0===f[l]&&(f[l]={key:l,atoms:[]}),f[l].atoms.push(d)}}function c(a){for(var b in f)for(var c=f[b],e=-1;1>=e;e++)for(var i=-1;1>=i;i++)for(var m=-1;1>=m;m++){var n=f[b].key+m+i*g+e*g*h;void 0!==f[n]&&d(c,f[n])}console.log("covalent bonds .... "+j.length),console.log("hydrogen bonds .... "+k.length),console.log("disulfide bonds ... "+l.length),a.bonds=j,a.hBonds=k,a.ssBonds=l}function d(a,b){for(var c in a.atoms){var d=a.atoms[c];for(var f in b.atoms){var g=b.atoms[f];if(d.serial<g.serial){var h=e(d,g);switch(h){case Bond.COVALENT:var i=new Bond(d,g);j.push(i);break;case Bond.HBOND:var i=new Bond(d,g);k.push(i);break;case Bond.SSBOND:var i=new Bond(d,g);l.push(i)}}}}}function e(a,b){var c=.25,d=3.61,e=2.2*2.2,f=12.25,g=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)+(b.z-a.z)*(b.z-a.z);return"SG"===a.name&&"SG"===b.name&&e>g?Bond.SSBOND:g>c&&d>g?Bond.COVALENT:"O"===a.name&&"N"===b.name&&f>g||"N"===a.name&&"O"===b.name&&f>g||"C"===a.name&&"O"===b.name&&f>g||"O"===a.name&&"C"===b.name&&f>g?Bond.HBOND:Bond.NONE}var f={},g=0,h=0,i=0,j=[],k=[],l=[];b(a),c(a)}function Molecule(a){Structure.call(this,a),this.information.classification=a.classification||"Unknown",this.atoms=a.atoms||[],this.bonds=[],this.colors=[],this.chains=a.chains||[]}function Raster(a){Structure.call(this,a),this.data=a.data||new Uint8ClampedArray,this.information.mode=a.mode||"8-bit",this.information.width=a.width,this.information.height=a.height,this.information.depth=a.depth||1,this.width=this.information.width,this.height=this.information.height,this.depth=this.information.depth,this.bbox={min:{x:0,y:0,z:0},max:{x:this.width,y:this.height,z:this.depth},center:{x:this.width/2,y:this.height/2,z:this.depth/2},radius:Math.sqrt(this.width*this.width+this.height*this.height+this.depth*this.depth)/2},this.centroid={x:this.width/2,y:this.height/2,z:this.depth/2},this.bins}function Structure(a){this.ID=a.ID||"0UNK",this.information={},this.information.ID=this.ID,this.information.title=a.title||"No Title",this.information.date=a.date||"00-UNK-00",this.centroid=a.centroid||{x:0,y:0,z:0},void 0!==a.matrix?this.matrix=a.matrix:(this.matrix=mat4.create(),mat4.identity(this.matrix)),this.bbox=a.bbox||{min:{x:Number.MAX_VALUE,y:Number.MAX_VALUE,z:Number.MAX_VALUE},max:{x:Number.MIN_VALUE,y:Number.MIN_VALUE,z:Number.MIN_VALUE},center:{x:0,y:0,z:0},radius:0}}function VecObj(){Structure.call(this)}function Console(){}function EventManager(){}!function(a){function b(){this.ID="node",this.name="none",this._isDirty=b.MATRIX|b.GEOMETRY|b.MATERIAL,this.parent=null,this.renderer=null,this.nodeGL=null,this.matrix=mat4.create(),mat4.identity(this.matrix)}b.CLEAN=0,b.MATRIX=1,b.GEOMETRY=2,b.MATERIAL=4,b.prototype.isDirty=function(){return this._isDirty},b.prototype.getNodeGL=function(){return this.nodeGL},b.prototype.getRenderer=function(){return null!=this.renderer?this.renderer:this.parent instanceof Renderer?(this.renderer=this.parent,this.renderer):this.parent.getRenderer()},b.prototype.init=function(a){},b.prototype.render=function(a){},b.prototype.translate=function(a,b,c){mat4.translate(this.matrix,this.matrix,[a,b,c])},b.prototype.graph=function(a){},a.Node=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Node.call(this),this.ID="leaf"}b.prototype=Object.create(mwSG.Node.prototype),b.prototype.constructor=b,b.prototype.init=function(a){console.log("INIT leaf "+this.ID),this.getNodeGL().init(a)},b.prototype.render=function(a){mat4.multiply(this.getNodeGL().workmatrix,this.parent.getNodeGL().workmatrix,this.matrix),this.getNodeGL().render(a)},b.prototype.update=function(a){this._isDirty!==Node.CLEAN&&(mat4.multiply(this.getNodeGL().workmatrix,this.parent.getNodeGL().workmatrix,this.matrix),this.getNodeGL().update(a),this._isDirty=Node.CLEAN)},b.prototype.graph=function(a){var b=this.ID||"unknown";return b},a.Leaf=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Node.call(this),this.ID="composite",this.children={}}b.prototype=Object.create(mwSG.Node.prototype),b.prototype.constructor=b,b.prototype.add=function(a){function b(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}a.name=a.ID+"_"+b(this.children),this.children[a.name]=a,a.parent=this},b.prototype.remove=function(a){void 0!==this.children.id&&delete this.children.id},b.prototype.getById=function(a){function b(a,c){if(c.ID===a)return c;for(var d in c.children){var e=b(a,c.children[d]);if(void 0!==e)return e}}return b(a,this)},b.prototype.init=function(a){this.getNodeGL().init(a);for(var b in this.children)this.children[b].init(a);this.isDirty=!1},b.prototype.render=function(a){this.parent instanceof Renderer||mat4.multiply(this.getNodeGL().workmatrix,this.parent.getNodeGL().workmatrix,this.matrix),this.getNodeGL().render(a);for(var b in this.children)this.children[b].render(a)},b.prototype.update=function(a){this._isDirty!==Node.CLEAN&&(mat4.multiply(this.getNodeGL().workmatrix,this.parent.getNodeGL().workmatrix,this.matrix),this.getNodeGL().update(a),this._isDirty=Node.CLEAN);for(var b in this.children)this.children[b].update(a)},b.prototype.graph=function(a){var b=a||0,c=Array(b+1).join("."),d=(this.ID||"unknown")+"\n";for(var e in this.children)d+=c+"+-"+this.children[e].graph(b++)+"\n";return d},b.prototype.traverse=function(a,b){for(var c in b.children)this.traverse(a,b.children[c])},a.Composite=b}(this.mwSG=this.mwSG||{});var ColorFactory=function(){var a={};return{get:function(b){switch(b){case"color_chain":return void 0===a.CHAIN&&(a.CHAIN=new ChainColorer),a.CHAIN;case"color_cpk":return void 0===a.CPK&&(a.CPK=new CPKColorer),a.CPK;case"color_mono":break;case"color_struct":break;case"color_rainbow":break;default:return void 0===a.CPK&&(a.CPK=new CPKColorer),a.CPK}}}}();CPKColorer.prototype.get=function(a){var b=CPKColorer.colors[a.symbol].rgb;return b},CPKColorer.colors={H:{symbol:"H",rgb:[1,1,1],rgbRasmol:[1,1,1]},HE:{symbol:"He",rgb:[.8509803921568627,1,1],rgbRasmol:[1,.7529411764705882,.796078431372549]},LI:{symbol:"Li",rgb:[.8,.5019607843137255,1],rgbRasmol:[.6980392156862745,.13333333333333333,.13333333333333333]},BE:{symbol:"Be",rgb:[.7607843137254902,1,0],rgbRasmol:[1,.0784313725490196,.5764705882352941]},B:{symbol:"B",rgb:[1,.7098039215686275,.7098039215686275],rgbRasmol:[0,1,0]},C:{symbol:"C",rgb:[.5647058823529412,.5647058823529412,.5647058823529412],rgbRasmol:[.7843137254901961,.7843137254901961,.7843137254901961]},N:{symbol:"N",rgb:[.18823529411764706,.3137254901960784,.9725490196078431],rgbRasmol:[.5607843137254902,.5607843137254902,1]},O:{symbol:"O",rgb:[1,.050980392156862744,.050980392156862744],rgbRasmol:[.9411764705882353,0,0]},F:{symbol:"F",rgb:[.5647058823529412,.8784313725490196,.3137254901960784],rgbRasmol:[.8549019607843137,.6470588235294118,.12549019607843137]},NE:{symbol:"Ne",rgb:[.7019607843137254,.8901960784313725,.9607843137254902],rgbRasmol:[1,.0784313725490196,.5764705882352941]},NA:{symbol:"Na",rgb:[.6705882352941176,.3607843137254902,.9490196078431372],rgbRasmol:[0,0,1]},MG:{symbol:"Mg",rgb:[.5411764705882353,1,0],rgbRasmol:[.13333333333333333,.5450980392156862,.13333333333333333]},AL:{symbol:"Al",rgb:[.7490196078431373,.6509803921568628,.6509803921568628],rgbRasmol:[.5019607843137255,.5019607843137255,.5647058823529412]},SI:{symbol:"Si",rgb:[.9411764705882353,.7843137254901961,.6274509803921569],rgbRasmol:[.8549019607843137,.6470588235294118,.12549019607843137]},P:{symbol:"P",rgb:[1,.5019607843137255,0],rgbRasmol:[1,.6470588235294118,0]},S:{symbol:"S",rgb:[1,1,.18823529411764706],rgbRasmol:[1,.7843137254901961,.19607843137254902]},CL:{symbol:"Cl",rgb:[.12156862745098039,.9411764705882353,.12156862745098039],rgbRasmol:[0,1,0]},AR:{symbol:"Ar",rgb:[.5019607843137255,.8196078431372549,.8901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]},K:{symbol:"K",rgb:[.5607843137254902,.25098039215686274,.8313725490196079],rgbRasmol:[1,.0784313725490196,.5764705882352941]},CA:{symbol:"Ca",rgb:[.23921568627450981,1,0],rgbRasmol:[.5019607843137255,.5019607843137255,.5647058823529412]},SC:{symbol:"Sc",rgb:[.9019607843137255,.9019607843137255,.9019607843137255],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TI:{symbol:"Ti",rgb:[.7490196078431373,.7607843137254902,.7803921568627451],rgbRasmol:[.5019607843137255,.5019607843137255,.5647058823529412]},V:{symbol:"V",rgb:[.6509803921568628,.6509803921568628,.6705882352941176],rgbRasmol:[1,.0784313725490196,.5764705882352941]},CR:{symbol:"Cr",rgb:[.5411764705882353,.6,.7803921568627451],rgbRasmol:[.5019607843137255,.5019607843137255,.5647058823529412]},MN:{symbol:"Mn",rgb:[.611764705882353,.47843137254901963,.7803921568627451],rgbRasmol:[.5019607843137255,.5019607843137255,.5647058823529412]},FE:{symbol:"Fe",rgb:[.8784313725490196,.4,.2],rgbRasmol:[1,.6470588235294118,0]},CO:{symbol:"Co",rgb:[.9411764705882353,.5647058823529412,.6274509803921569],rgbRasmol:[1,.0784313725490196,.5764705882352941]},NI:{symbol:"Ni",rgb:[.3137254901960784,.8156862745098039,.3137254901960784],rgbRasmol:[.6470588235294118,.16470588235294117,.16470588235294117]},CU:{symbol:"Cu",rgb:[.7843137254901961,.5019607843137255,.2],rgbRasmol:[.6470588235294118,.16470588235294117,.16470588235294117]},ZN:{symbol:"Zn",rgb:[.49019607843137253,.5019607843137255,.6901960784313725],rgbRasmol:[.6470588235294118,.16470588235294117,.16470588235294117]},GA:{symbol:"Ga",rgb:[.7607843137254902,.5607843137254902,.5607843137254902],rgbRasmol:[1,.0784313725490196,.5764705882352941]},GE:{symbol:"Ge",rgb:[.4,.5607843137254902,.5607843137254902],rgbRasmol:[1,.0784313725490196,.5764705882352941]},AS:{symbol:"As",rgb:[.7411764705882353,.5019607843137255,.8901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]},SE:{symbol:"Se",rgb:[1,.6313725490196078,0],rgbRasmol:[1,.0784313725490196,.5764705882352941]},BR:{symbol:"Br",rgb:[.6509803921568628,.1607843137254902,.1607843137254902],rgbRasmol:[.6470588235294118,.16470588235294117,.16470588235294117]},KR:{symbol:"Kr",rgb:[.3607843137254902,.7215686274509804,.8196078431372549],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RB:{symbol:"Rb",rgb:[.4392156862745098,.1803921568627451,.6901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]},SR:{symbol:"Sr",rgb:[0,1,0],rgbRasmol:[1,.0784313725490196,.5764705882352941]},Y:{symbol:"Y",rgb:[.5803921568627451,1,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},ZR:{symbol:"Zr",rgb:[.5803921568627451,.8784313725490196,.8784313725490196],rgbRasmol:[1,.0784313725490196,.5764705882352941]},NB:{symbol:"Nb",rgb:[.45098039215686275,.7607843137254902,.788235294117647],rgbRasmol:[1,.0784313725490196,.5764705882352941]},MO:{symbol:"Mo",rgb:[.32941176470588235,.7098039215686275,.7098039215686275],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TC:{symbol:"Tc",rgb:[.23137254901960785,.6196078431372549,.6196078431372549],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RU:{symbol:"Ru",rgb:[.1411764705882353,.5607843137254902,.5607843137254902],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RH:{symbol:"Rh",rgb:[.0392156862745098,.49019607843137253,.5490196078431373],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PD:{symbol:"Pd",rgb:[0,.4117647058823529,.5215686274509804],rgbRasmol:[1,.0784313725490196,.5764705882352941]},AG:{symbol:"Ag",rgb:[.7529411764705882,.7529411764705882,.7529411764705882],rgbRasmol:[.5019607843137255,.5019607843137255,.5647058823529412]},CD:{symbol:"Cd",rgb:[1,.8509803921568627,.5607843137254902],rgbRasmol:[1,.0784313725490196,.5764705882352941]},IN:{symbol:"In",rgb:[.6509803921568628,.4588235294117647,.45098039215686275],rgbRasmol:[1,.0784313725490196,.5764705882352941]},SN:{symbol:"Sn",rgb:[.4,.5019607843137255,.5019607843137255],rgbRasmol:[1,.0784313725490196,.5764705882352941]},SB:{symbol:"Sb",rgb:[.6196078431372549,.38823529411764707,.7098039215686275],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TE:{symbol:"Te",rgb:[.8313725490196079,.47843137254901963,0],rgbRasmol:[1,.0784313725490196,.5764705882352941]},I:{symbol:"I",rgb:[.5803921568627451,0,.5803921568627451],rgbRasmol:[.6274509803921569,.12549019607843137,.9411764705882353]},XE:{symbol:"Xe",rgb:[.25882352941176473,.6196078431372549,.6901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]},CS:{symbol:"Cs",rgb:[.3411764705882353,.09019607843137255,.5607843137254902],rgbRasmol:[1,.0784313725490196,.5764705882352941]},BA:{symbol:"Ba",rgb:[0,.788235294117647,0],rgbRasmol:[1,.6470588235294118,0]},LA:{symbol:"La",rgb:[.4392156862745098,.8313725490196079,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},CE:{symbol:"Ce",rgb:[1,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PR:{symbol:"Pr",rgb:[.8509803921568627,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},ND:{symbol:"Nd",rgb:[.7803921568627451,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PM:{symbol:"Pm",rgb:[.6392156862745098,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},SM:{symbol:"Sm",rgb:[.5607843137254902,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},EU:{symbol:"Eu",rgb:[.3803921568627451,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},GD:{symbol:"Gd",rgb:[.27058823529411763,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TB:{symbol:"Tb",rgb:[.18823529411764706,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},DY:{symbol:"Dy",rgb:[.12156862745098039,1,.7803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},HO:{symbol:"Ho",rgb:[0,1,.611764705882353],rgbRasmol:[1,.0784313725490196,.5764705882352941]},ER:{symbol:"Er",rgb:[0,.9019607843137255,.4588235294117647],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TM:{symbol:"Tm",rgb:[0,.8313725490196079,.3215686274509804],rgbRasmol:[1,.0784313725490196,.5764705882352941]},YB:{symbol:"Yb",rgb:[0,.7490196078431373,.2196078431372549],rgbRasmol:[1,.0784313725490196,.5764705882352941]},LU:{symbol:"Lu",rgb:[0,.6705882352941176,.1411764705882353],rgbRasmol:[1,.0784313725490196,.5764705882352941]},HF:{symbol:"Hf",rgb:[.30196078431372547,.7607843137254902,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TA:{symbol:"Ta",rgb:[.30196078431372547,.6509803921568628,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},W:{symbol:"W",rgb:[.12941176470588237,.5803921568627451,.8392156862745098],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RE:{symbol:"Re",rgb:[.14901960784313725,.49019607843137253,.6705882352941176],rgbRasmol:[1,.0784313725490196,.5764705882352941]},OS:{symbol:"Os",rgb:[.14901960784313725,.4,.5882352941176471],rgbRasmol:[1,.0784313725490196,.5764705882352941]},IR:{symbol:"Ir",rgb:[.09019607843137255,.32941176470588235,.5294117647058824],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PT:{symbol:"Pt",rgb:[.8156862745098039,.8156862745098039,.8784313725490196],rgbRasmol:[1,.0784313725490196,.5764705882352941]},AU:{symbol:"Au",rgb:[1,.8196078431372549,.13725490196078433],rgbRasmol:[.8549019607843137,.6470588235294118,.12549019607843137]},HG:{symbol:"Hg",rgb:[.7215686274509804,.7215686274509804,.8156862745098039],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TL:{symbol:"Tl",rgb:[.6509803921568628,.32941176470588235,.30196078431372547],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PB:{symbol:"Pb",rgb:[.3411764705882353,.34901960784313724,.3803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},BI:{symbol:"Bi",rgb:[.6196078431372549,.30980392156862746,.7098039215686275],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PO:{symbol:"Po",rgb:[.6705882352941176,.3607843137254902,0],rgbRasmol:[1,.0784313725490196,.5764705882352941]},AT:{symbol:"At",rgb:[.4588235294117647,.30980392156862746,.27058823529411763],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RN:{symbol:"Rn",rgb:[.25882352941176473,.5098039215686274,.5882352941176471],rgbRasmol:[1,.0784313725490196,.5764705882352941]},FR:{symbol:"Fr",rgb:[.25882352941176473,0,.4],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RA:{symbol:"Ra",rgb:[0,.49019607843137253,0],rgbRasmol:[1,.0784313725490196,.5764705882352941]},AC:{symbol:"Ac",rgb:[.4392156862745098,.6705882352941176,.9803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},TH:{symbol:"Th",rgb:[0,.7294117647058823,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PA:{symbol:"Pa",rgb:[0,.6313725490196078,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},U:{symbol:"U",rgb:[0,.5607843137254902,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},NP:{symbol:"Np",rgb:[0,.5019607843137255,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},PU:{symbol:"Pu",rgb:[0,.4196078431372549,1],rgbRasmol:[1,.0784313725490196,.5764705882352941]},AM:{symbol:"Am",rgb:[.32941176470588235,.3607843137254902,.9490196078431372],rgbRasmol:[1,.0784313725490196,.5764705882352941]},CM:{symbol:"Cm",rgb:[.47058823529411764,.3607843137254902,.8901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]},BK:{symbol:"Bk",rgb:[.5411764705882353,.30980392156862746,.8901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]},CF:{symbol:"Cf",rgb:[.6313725490196078,.21176470588235294,.8313725490196079],rgbRasmol:[1,.0784313725490196,.5764705882352941]},ES:{symbol:"Es",rgb:[.7019607843137254,.12156862745098039,.8313725490196079],rgbRasmol:[1,.0784313725490196,.5764705882352941]},FM:{symbol:"Fm",rgb:[.7019607843137254,.12156862745098039,.7294117647058823],rgbRasmol:[1,.0784313725490196,.5764705882352941]},MD:{symbol:"Md",rgb:[.7019607843137254,.050980392156862744,.6509803921568628],rgbRasmol:[1,.0784313725490196,.5764705882352941]},NO:{symbol:"No",rgb:[.7411764705882353,.050980392156862744,.5294117647058824],rgbRasmol:[1,.0784313725490196,.5764705882352941]},LR:{symbol:"Lr",rgb:[.7803921568627451,0,.4],rgbRasmol:[1,.0784313725490196,.5764705882352941]},RF:{symbol:"Rf",rgb:[.8,0,.34901960784313724],rgbRasmol:[1,.0784313725490196,.5764705882352941]},DB:{symbol:"Db",rgb:[.8196078431372549,0,.30980392156862746],rgbRasmol:[1,.0784313725490196,.5764705882352941]},SG:{symbol:"Sg",rgb:[.8509803921568627,0,.27058823529411763],rgbRasmol:[1,.0784313725490196,.5764705882352941]},BH:{symbol:"Bh",rgb:[.8784313725490196,0,.2196078431372549],rgbRasmol:[1,.0784313725490196,.5764705882352941]},HS:{symbol:"Hs",rgb:[.9019607843137255,0,.1803921568627451],rgbRasmol:[1,.0784313725490196,.5764705882352941]},MT:{symbol:"Mt",rgb:[.9215686274509803,0,.14901960784313725],rgbRasmol:[1,.0784313725490196,.5764705882352941]}},ChainColorer.prototype.get=function(a){var b=[];return b="HETATM"===a.type?ChainColorer.colors[a.chain].rgbHETATM:ChainColorer.colors[a.chain].rgbATOM},ChainColorer.colors={0:{chainID:"0",rgbATOM:[0,1,.4980392156862745],rgbHETATM:[0,.8117647058823529,.43529411764705883]},1:{chainID:"1",rgbATOM:[.23529411764705882,.7019607843137254,.44313725490196076],rgbHETATM:[.20392156862745098,.6078431372549019,.3803921568627451]},2:{chainID:"2",rgbATOM:[0,0,.5450980392156862],rgbHETATM:[0,0,.7333333333333333]},3:{chainID:"3",rgbATOM:[.7411764705882353,.7176470588235294,.4196078431372549],rgbHETATM:[.6470588235294118,.6235294117647059,.3568627450980392]},4:{chainID:"4",rgbATOM:[0,.39215686274509803,0],rgbHETATM:[0,.5803921568627451,0]},5:{chainID:"5",rgbATOM:[.5019607843137255,0,0],rgbHETATM:[.6901960784313725,0,0]},6:{chainID:"6",rgbATOM:[.5019607843137255,.5019607843137255,0],rgbHETATM:[.6901960784313725,.6901960784313725,0]},7:{chainID:"7",rgbATOM:[.5019607843137255,0,.5019607843137255],rgbHETATM:[.6901960784313725,0,.6901960784313725]},8:{chainID:"8",rgbATOM:[0,.5019607843137255,.5019607843137255],rgbHETATM:[0,.6901960784313725,.6901960784313725]},9:{chainID:"9",rgbATOM:[.7215686274509804,.5254901960784314,.043137254901960784],rgbHETATM:[.9098039215686274,.7137254901960784,.07450980392156863]},A:{chainID:"A",rgbATOM:[.7529411764705882,.8156862745098039,1],rgbHETATM:[.5647058823529412,.6274509803921569,.8117647058823529]},a:{chainID:"a",rgbATOM:[.7529411764705882,.8156862745098039,1],rgbHETATM:[.5647058823529412,.6274509803921569,.8117647058823529]},B:{chainID:"B",rgbATOM:[.6901960784313725,1,.6901960784313725],rgbHETATM:[.5019607843137255,.8117647058823529,.596078431372549]},b:{chainID:"b",rgbATOM:[.6901960784313725,1,.6901960784313725],rgbHETATM:[.5019607843137255,.8117647058823529,.596078431372549]},C:{chainID:"C",rgbATOM:[1,.7529411764705882,.7843137254901961],rgbHETATM:[.8117647058823529,.5647058823529412,.6901960784313725]},c:{chainID:"c",rgbATOM:[1,.7529411764705882,.7843137254901961],rgbHETATM:[.8117647058823529,.5647058823529412,.6901960784313725]},D:{chainID:"D",rgbATOM:[1,1,.5019607843137255],rgbHETATM:[.8117647058823529,.8117647058823529,.4392156862745098]},d:{chainID:"d",rgbATOM:[1,1,.5019607843137255],rgbHETATM:[.8117647058823529,.8117647058823529,.4392156862745098]},E:{chainID:"E",rgbATOM:[1,.7529411764705882,1],rgbHETATM:[.8117647058823529,.5647058823529412,.8117647058823529]},e:{chainID:"e",rgbATOM:[1,.7529411764705882,1],rgbHETATM:[.8117647058823529,.5647058823529412,.8117647058823529]},F:{chainID:"F",rgbATOM:[.6901960784313725,.9411764705882353,.9411764705882353],rgbHETATM:[.5019607843137255,.7529411764705882,.7529411764705882]},f:{chainID:"f",rgbATOM:[.6901960784313725,.9411764705882353,.9411764705882353],rgbHETATM:[.5019607843137255,.7529411764705882,.7529411764705882]},G:{chainID:"G",rgbATOM:[1,.8156862745098039,.4392156862745098],rgbHETATM:[.8117647058823529,.6274509803921569,.3764705882352941]},g:{chainID:"g",rgbATOM:[1,.8156862745098039,.4392156862745098],rgbHETATM:[.8117647058823529,.6274509803921569,.3764705882352941]},H:{chainID:"H",rgbATOM:[.9411764705882353,.5019607843137255,.5019607843137255],rgbHETATM:[.7529411764705882,.3137254901960784,.4392156862745098]},h:{chainID:"h",rgbATOM:[.9411764705882353,.5019607843137255,.5019607843137255],rgbHETATM:[.7529411764705882,.3137254901960784,.4392156862745098]},I:{chainID:"I",rgbATOM:[.9607843137254902,.8705882352941177,.7019607843137254],rgbHETATM:[.7725490196078432,.6823529411764706,.5137254901960784]},i:{chainID:"i",rgbATOM:[.9607843137254902,.8705882352941177,.7019607843137254],rgbHETATM:[.7725490196078432,.6823529411764706,.5137254901960784]},J:{chainID:"J",rgbATOM:[0,.7490196078431373,1],rgbHETATM:[0,.6549019607843137,.8117647058823529]},j:{chainID:"j",rgbATOM:[0,.7490196078431373,1],rgbHETATM:[0,.6549019607843137,.8117647058823529]},K:{chainID:"K",rgbATOM:[.803921568627451,.3607843137254902,.3607843137254902],rgbHETATM:[.7098039215686275,.2980392156862745,.2980392156862745]},k:{chainID:"k",rgbATOM:[.803921568627451,.3607843137254902,.3607843137254902],rgbHETATM:[.7098039215686275,.2980392156862745,.2980392156862745]},L:{chainID:"L",rgbATOM:[.4,.803921568627451,.6666666666666666],rgbHETATM:[.33725490196078434,.7098039215686275,.5725490196078431]},l:{chainID:"l",rgbATOM:[.4,.803921568627451,.6666666666666666],rgbHETATM:[.33725490196078434,.7098039215686275,.5725490196078431]},M:{chainID:"M",rgbATOM:[.6039215686274509,.803921568627451,.19607843137254902],rgbHETATM:[.5411764705882353,.7098039215686275,.16470588235294117]},m:{chainID:"m",rgbATOM:[.6039215686274509,.803921568627451,.19607843137254902],rgbHETATM:[.5411764705882353,.7098039215686275,.16470588235294117]},N:{chainID:"N",rgbATOM:[.9333333333333333,.5098039215686274,.9333333333333333],rgbHETATM:[.7450980392156863,.4470588235294118,.7450980392156863]},n:{chainID:"n",rgbATOM:[.9333333333333333,.5098039215686274,.9333333333333333],rgbHETATM:[.7450980392156863,.4470588235294118,.7450980392156863]},O:{chainID:"O",rgbATOM:[0,.807843137254902,.8196078431372549],rgbHETATM:[0,.7137254901960784,.6313725490196078]},o:{chainID:"o",rgbATOM:[0,.807843137254902,.8196078431372549],rgbHETATM:[0,.7137254901960784,.6313725490196078]},P:{chainID:"P",rgbATOM:[0,1,.4980392156862745],rgbHETATM:[0,.8117647058823529,.43529411764705883]},p:{chainID:"p",rgbATOM:[0,1,.4980392156862745],rgbHETATM:[0,.8117647058823529,.43529411764705883]},Q:{chainID:"Q",rgbATOM:[.23529411764705882,.7019607843137254,.44313725490196076],rgbHETATM:[.20392156862745098,.6078431372549019,.3803921568627451]},q:{chainID:"q",rgbATOM:[.23529411764705882,.7019607843137254,.44313725490196076],rgbHETATM:[.20392156862745098,.6078431372549019,.3803921568627451]},R:{chainID:"R",rgbATOM:[0,0,.5450980392156862],rgbHETATM:[0,0,.7333333333333333]},r:{chainID:"r",rgbATOM:[0,0,.5450980392156862],rgbHETATM:[0,0,.7333333333333333]},S:{chainID:"S",rgbATOM:[.7411764705882353,.7176470588235294,.4196078431372549],rgbHETATM:[.6470588235294118,.6235294117647059,.3568627450980392]},s:{chainID:"s",rgbATOM:[.7411764705882353,.7176470588235294,.4196078431372549],rgbHETATM:[.6470588235294118,.6235294117647059,.3568627450980392]},T:{chainID:"T",rgbATOM:[0,.39215686274509803,0],rgbHETATM:[0,.5803921568627451,0]},t:{chainID:"t",rgbATOM:[0,.39215686274509803,0],rgbHETATM:[0,.5803921568627451,0]},U:{chainID:"U",rgbATOM:[.5019607843137255,0,0],rgbHETATM:[.6901960784313725,0,0]},u:{chainID:"u",rgbATOM:[.5019607843137255,0,0],rgbHETATM:[.6901960784313725,0,0]},V:{chainID:"V",rgbATOM:[.5019607843137255,.5019607843137255,0],rgbHETATM:[.6901960784313725,.6901960784313725,0]},v:{chainID:"v",rgbATOM:[.5019607843137255,.5019607843137255,0],rgbHETATM:[.6901960784313725,.6901960784313725,0]},W:{chainID:"W",rgbATOM:[.5019607843137255,0,.5019607843137255],rgbHETATM:[.6901960784313725,0,.6901960784313725]},w:{chainID:"w",rgbATOM:[.5019607843137255,0,.5019607843137255],rgbHETATM:[.6901960784313725,0,.6901960784313725]},X:{chainID:"X",rgbATOM:[0,.5019607843137255,.5019607843137255],rgbHETATM:[0,.6901960784313725,.6901960784313725]},x:{chainID:"x",rgbATOM:[0,.5019607843137255,.5019607843137255],rgbHETATM:[0,.6901960784313725,.6901960784313725]},Y:{chainID:"Y",rgbATOM:[.7215686274509804,.5254901960784314,.043137254901960784],rgbHETATM:[.9098039215686274,.7137254901960784,.07450980392156863]},y:{chainID:"y",rgbATOM:[.7215686274509804,.5254901960784314,.043137254901960784],rgbHETATM:[.9098039215686274,.7137254901960784,.07450980392156863]},Z:{chainID:"Z",rgbATOM:[.6980392156862745,.13333333333333333,.13333333333333333],rgbHETATM:[.7607843137254902,.19607843137254902,.19607843137254902]},z:{chainID:"z",rgbATOM:[.6980392156862745,.13333333333333333,.13333333333333333],rgbHETATM:[.7607843137254902,.19607843137254902,.19607843137254902]},_:{chainID:"_",rgbATOM:[1,1,1],rgbHETATM:[1,1,1]}},PointGeometer.prototype.getShape=function(){if(void 0===this.shape){this.shape=new Shape;for(var a=[],b=0;b<this.mol.atoms.length;b++){a.push(this.mol.atoms[b].x),a.push(this.mol.atoms[b].y),a.push(this.mol.atoms[b].z);var c=this.colorer.get(this.mol.atoms[b]);a.push(c[0]),a.push(c[1]),a.push(c[2])}this.shape.type="POINTS",this.shape.addVertexData({content:Shape.XYZ|Shape.RGB,data:a,attributes:[new Attribute("aVertexPosition",0,6),new Attribute("aVertexColor",3,6)]}),console.log(this.mol.centroid),this.shape.translate(-this.mol.centroid.x,-this.mol.centroid.y,-this.mol.centroid.z)}return console.log(this.shape),this.shape},WireGeometer.prototype.getShape=function(){var a=[],b=[],c=[],d=function(d,e){for(var f={},g=0,h=0;h<d.bonds.length;h++){var i=d.bonds[h],j=e.get(i.atom1);void 0===f[i.atom1.serial]&&(g=a.length/3,a.push(i.atom1.x),a.push(i.atom1.y),a.push(i.atom1.z),b.push(j[0]),b.push(j[1]),b.push(j[2]),f[i.atom1.serial]=g),g=a.length/3,a.push(i.middle.x),a.push(i.middle.y),a.push(i.middle.z),b.push(j[0]),b.push(j[1]),b.push(j[2]),c.push(f[i.atom1.serial]),c.push(g);var k=e.get(i.atom2);void 0===f[i.atom2.serial]&&(g=a.length/3,a.push(i.atom2.x),a.push(i.atom2.y),a.push(i.atom2.z),b.push(k[0]),b.push(k[1]),b.push(k[2]),f[i.atom2.serial]=g),g=a.length/3,a.push(i.middle.x),a.push(i.middle.y),a.push(i.middle.z),b.push(k[0]),b.push(k[1]),b.push(k[2]),c.push(f[i.atom2.serial]),c.push(g)}};return void 0===this.shape&&((void 0===this.mol.bonds||0===this.mol.bonds.length)&&BondCalculator(this.mol),d(this.mol,this.colorer),this.shape=new mwSG.Shape,this.shape.type="LINES",this.shape.addVertexData({content:mwSG.Shape.XYZ,data:a,attributes:[new Attribute("aVertexPosition",0,0)]}),this.shape.addVertexData({content:mwSG.Shape.RGB,data:b,attributes:[new Attribute("aVertexColor",0,0)]}),this.shape.addVertexData({content:mwSG.Shape.INDICES,data:c}),this.shape.translate(-this.mol.centroid.x,-this.mol.centroid.y,-this.mol.centroid.z)),this.shape},Renderer.prototype.getContext=function(){return this.context},Renderer.prototype.addScene=function(a){this.scene=a,a.parent=this},Renderer.prototype.getScene=function(){return this.scene},Renderer.prototype.addShader=function(a){this.shaders.push(a)},Renderer.prototype.addSensor=function(a){this.sensor=a,this.sensor.setRenderer(this)},Renderer.prototype.setUniform=function(a,b){for(var c in this.shaders){var d=this.shaders[c];d.uniforms[a].value=b}},Renderer.prototype.init=function(){var a=this.context;this.scene.init(a)},Renderer.prototype.drawScene=function(){var a=this.context;a.viewport(0,0,a.viewportWidth,a.viewportHeight),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),
console.log("*************** RENDER ***************"),this.scene.render(a)},Renderer.FLOAT_IN_BYTES=4,Renderer.prototype._initGL=function(){var a=this.context;a.clearColor(.1,.1,.1,1),a.enable(a.DEPTH_TEST),a.getExtension("EXT_frag_depth"),a.getSupportedExtensions().indexOf("EXT_frag_depth")<0&&alert("Extension frag_depth not supported"),this.program=new Program},function(a){function b(a){this.sgnode=a,this.glType=-1,this._isDirty=!0,this.workmatrix=mat4.create(),mat4.identity(this.workmatrix)}b.prototype.isDirty=function(){return _isDirty},b.prototype.setViewport=function(a,b){mat4.perspective(this.sgnode.projMatrix,this.sgnode.fovy*this.sgnode.zoom,a/b,this.sgnode.zNear,this.sgnode.zFar)},b.prototype.init=function(a){this.isDirty=!1},b.prototype.render=function(a){var b=a;this.setViewport(b.viewportWidth,b.viewportHeight),this.sgnode.getRenderer().setUniform("uVMatrix",this.sgnode.viewMatrix),this.sgnode.getRenderer().setUniform("uPMatrix",this.sgnode.projMatrix)},a.Camera=b}(this.mwGL=this.mwGL||{}),NodeGL.prototype.isDirty=function(){return _isDirty},NodeGL.prototype.init=function(a){this.isDirty=!1},NodeGL.prototype.render=function(a){},ShapeGL.prototype.init=function(a){var b=this.sgnode;this.sgnode.getRenderer().addShader(this.shaderProgram);for(var c in b.geometries)this.VBOs[c]=this._createVBO(a,b.geometries[c]);for(var c=0;c<b.textures.length;c++)this.GLTextures.push(this._createTexture(a,b.textures[c]));this.isDirty=!1},ShapeGL.prototype.render=function(a){var b=a;mat4.multiply(this.workmatrix,this.sgnode.parent.getNodeGL().workmatrix,this.sgnode.matrix),this.sgnode.getRenderer().setUniform("uMMatrix",this.workmatrix),this.shaderProgram.use();for(var c=0;c<this.VBOs.length;c++){var d=this.VBOs[c];"indexed"===d.type?b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.ID):b.bindBuffer(b.ARRAY_BUFFER,d.ID);for(var e in d.attributes){var f=d.attributes[e];b.enableVertexAttribArray(f.location),b.vertexAttribPointer(f.location,f.size,b.FLOAT,!1,f.stride*Renderer.FLOAT_IN_BYTES,f.offset*Renderer.FLOAT_IN_BYTES)}}for(var g=0;g<this.GLTextures.length;g++)void 0!==this.GLTextures[g]&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.GLTextures[g]),this.sgnode.getRenderer().setUniform("uTexture",0));this.GLTextures.length>0,this.shaderProgram.updateUniforms(),0!=this.numIndices?b.drawElements(this.glType,this.numIndices,b.UNSIGNED_SHORT,0):b.drawArrays(this.glType,0,this.numItems)},ShapeGL.prototype.removeVBO=function(a){for(var b=this.context,c=0,d=!1;!d;)this.VBOs[c].content===a&&(d=!0),c++,c>=this.VBOs.length&&(d=!0,c=-1);if(-1!==c){var e=this.VBOs[c];b.bindBuffer(b.ARRAY_BUFFER,e.ID),b.bufferData(b.ARRAY_BUFFER,1,b.STATIC_DRAW),b.deleteBuffer(e.ID),"indexed"===e.type&&(b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.IndxID),b.bufferData(b.ELEMENT_ARRAY_BUFFER,1,b.STATIC_DRAW),b.deleteBuffer(e.IndxID)),delete this.VBOs[c]}},ShapeGL.prototype._createVBO=function(a,b){var c=a;switch(this.sgnode.type){case"POINTS":case"POINTS_RADIUS":this.glType=c.POINTS;break;case"LINES":this.glType=c.LINES;break;case"LINE_STRIP":this.glType=c.LINE_STRIP;break;case"LINE_LOOP":this.glType=c.LINE_LOOP;break;case"TRIANGLES":this.glType=c.TRIANGLES;break;case"TRIANGLE_STRIP":this.glType=c.TRIANGLE_STRIP}var d={};d.attributes=[],d.type=b.type,d.content=b.content,d.ID=c.createBuffer(),"indexed"===d.type?(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,d.ID),c.bufferData(c.ELEMENT_ARRAY_BUFFER,b.data,c.STATIC_DRAW),this.numIndices=b.data.length):(c.bindBuffer(c.ARRAY_BUFFER,d.ID),c.bufferData(c.ARRAY_BUFFER,b.data,c.STATIC_DRAW));for(var e=0;e<b.attributes.length;e++){if((b.content&mwSG.Shape.XYZ)===mwSG.Shape.XYZ){for(var f=32,g=0;0!=f;)(b.content&f)===f&&(g+=mwSG.Shape.itemLength[f]),f/=2;this.numItems=b.data.length/g}d.attributes[e]={},d.attributes[e].name=b.attributes[e].name,d.attributes[e].location=this.shaderProgram.getAttribLocation(b.attributes[e].name),d.attributes[e].size=this.shaderProgram.attributes[d.attributes[e].name].size,d.attributes[e].stride=b.attributes[e].stride,d.attributes[e].offset=b.attributes[e].offset}return d},ShapeGL.prototype._createTexture=function(a,b){function c(a,b){function c(a){return 0==(a&a-1)}if(c(a.width)&&c(a.height))d.bindTexture(d.TEXTURE_2D,b),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a),d.bindTexture(d.TEXTURE_2D,null);else{var e="ERR: The texture "+a.src+" has non power-of-two dimension";alert(e)}}var d=a,e=d.createTexture();this.GLTextures.push(e),b.onload=function(){c(b,e)}},ShapeGL.prototype._updateAttributes=function(a){for(var b=0;b<this.geometry.VBO.length;b++)for(var c=this.geometry.VBO[b],d=0;d<c.attributes.length;d++)c.attributes[d].location=this.shaderProgram.getAttribLocation(c.attributes[d].name),c.attributes[d].size=this.shaderProgram.attributes[c.attributes[d].name].size},function(a){function b(){mwSG.Leaf.call(this),this.ID="camera",this.projMatrix=mat4.create(),this.viewMatrix=mat4.create(),mat4.identity(this.viewMatrix),this.fovy=45*Math.PI/180,this.zoom=1,this.zNear=.1,this.zFar=1e3,this.nodeGL=new mwGL.Camera(this)}b.prototype=Object.create(mwSG.Leaf.prototype),b.prototype.constructor=b,b.prototype.setFovy=function(a){this.fovy=a*Math.PI/180},b.prototype.setZoom=function(a){this.zoom=a},a.Camera=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Composite.call(this),this.ID="group[camera]",this.nodeGL=new NodeGL(this)}b.prototype=Object.create(mwSG.Composite.prototype),b.prototype.add=function(a){a instanceof mwSG.Camera&&Composite.add.call(this,a)},a.CameraGroup=b}(this.mwSG=this.mwSG||{}),function(a){function b(a){this.type=a.type||"none",this.content=a.content,this.data=a.data,this.attributes=a.attributes,this.indices=a.indices,"indexed"===this.type?this._isIndexed=!0:this._isIndexed=!1}b.prototype.getBuffer=function(a){for(var b=!1,c=0;!b&&c<this.VBO.length;){if(this.VBO[c].type===a)return this.VBO[c];c++}return null},b.prototype.isIndexed=function(){return this._isIndexed},a.Geometry=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Leaf.call(this),this.ID="light",this.nodeGL=new NodeGL(this)}b.prototype=Object.create(mwSG.Leaf.prototype),b.prototype.constructor=b,a.Light=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Composite.call(this),this.ID="scene",this.nodeGL=new NodeGL(this)}b.prototype=Object.create(mwSG.Composite.prototype),b.prototype.setDefault=function(){this.ID="scene_default";var a=new mwSG.Camera;this.add(a),this.add(new mwSG.Light)},b.prototype.getCamera=function(){return this.children.camera_0},b.prototype.toString=function(){var a=this.ID+"\n";for(var b in this.children)a+="+-"+this.children[b]+"\n";return a},a.Scene=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Leaf.call(this),this.ID="shape",this.colorMode="monochrome",this.shaderProgram=null,this.geometries=[],this.textures=[],this.uniforms=[],this.type="POINTS",this.centroid={x:0,y:0,z:0},this._isIndexed=!1,this.nodeGL=new ShapeGL(this)}b.prototype=Object.create(mwSG.Leaf.prototype),b.XYZ=1,b.XYZW=2,b.NXYZ=4,b.RGB=8,b.RGBA=16,b.ST=32,b.INDICES=64,b.itemLength={1:3,2:4,4:3,8:3,16:4,32:2,64:1},b.prototype.setProgram=function(a){this.nodeGL.shaderProgram=a},b.prototype.isIndexedGeometry=function(){return this._isIndexed},b.prototype.addVertexData=function(a){(a.content&b.INDICES)===b.INDICES?(this._isIndexed=!0,this.geometries.push(new mwSG.Geometry({type:"indexed",content:a.content,data:new Uint16Array(a.data),attributes:[]}))):this.geometries.push(new mwSG.Geometry({type:"vertex",content:a.content,data:new Float32Array(a.data),attributes:a.attributes}))},b.prototype.addTexture=function(a){var b=new Image;b.src=a,this.textures.push(b)},b.prototype.addUniformData=function(a){this.uniforms.push(a)},b.prototype.removeVertexData=function(a){for(var c=0,d=!1;!d;)this.geometries[c].content===a&&(d=!0),c++,c>=this.geometries[c].length&&(d=!0,c=-1);-1!==c&&delete this.geometries[c],this.nodeGL.removeVBO(a),(this.type&b.XYZ)===b.XYZ||(this.type&b.XYZW)===b.XYZW||(this.type&b.NXYZ)===b.NXYZ?this._isDirty&=~Node.GEOMETRY:this._isDirty&=~Node.MATERIAL},b.prototype.setCentroid=function(a){this.centroid=a},b.prototype.update=function(a){},b.prototype.updateUniforms=function(a){},a.Shape=b}(this.mwSG=this.mwSG||{}),function(a){function b(){mwSG.Composite.call(this),this.ID="group[shape]",this.nodeGL=new NodeGL(this)}b.prototype=Object.create(mwSG.Composite.prototype),a.ShapeGroup=b}(this.mwSG=this.mwSG||{});var ShaderFactory=function(){var a={},b=(new Program,{template:["attribute vec3 aVertexPosition;","attribute vec3 aVertexColor;","uniform mat4 uMMatrix;","uniform mat4 uVMatrix;","uniform mat4 uPMatrix;","varying vec3 vColor;","void main(void) {","gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aVertexPosition, 1.0);","vColor = aVertexColor;","}"],points:["gl_PointSize = 8.0;"]}),c={template:["precision mediump float;","varying vec3 vColor;","void main(void) {","gl_FragColor = vec4( vColor,1.0);","}"],disks_func:["void drawDisk(xy) {","vec2 v = xy - vec2(0.5,0.5);","float d = dot(v,v);","if (d > 0.25) discard;","}"],disks_call:["drawDisk(gl_PointCoord.xy);"]};return{get:function(d){var e=!1,f="",g="",h="";switch(d.displayType){case"points":h="disks",void 0===a[h]&&(e=!0,f=b.template.join(""),g=c.template.join(""));break;case"wireframe":if(h="wireframe",void 0===a[h]){e=!0;var i=[{src:"#{func}",dest:"disks_func"},{src:"#{func_call}",dest:"disks_call"}];f=b.template.join(""),g=c.template.join("");for(var j=0;j<i.length;j++){var k=new RegExp(i[j].src,"g");f=f.replace(k,b[i[j].dest].join("")),g=g.replace(k,b[i[j].dest].join(""))}}break;default:return null}if(e){console.log("Compile+link "+h),console.log("vs\n"+f),console.log("fs\n"+g);var l=new Program(d.glContext,h);l.load("x-shader/x-vertex",f),l.load("x-shader/x-fragment",g),l.link(),l.setUniformLocation("uPMatrix"),l.setUniformLocation("uVMatrix"),l.setUniformLocation("uMMatrix"),a[h]=l}return a[h]}}}();Program.prototype.getID=function(){return this.shaderProgram},Program.prototype.load=function(a,b){var c=this.ctx;if("x-shader/x-fragment"===a)this.fragment_shader=this._compile(c.FRAGMENT_SHADER,b);else{if("x-shader/x-vertex"!==a)return null;this.vertex_shader=this._compile(c.VERTEX_SHADER,b)}this._createAttributesAndUniforms(b)},Program.prototype.loadHTTP=function(a,b){var c=this.ctx,d="shaders/"+b+"."+a,e=new XMLHttpRequest;e.open("GET",d,!0),e.responseType="text",e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(this.fragment_shader=this._compile(c.FRAGMENT_SHADER,this.response))},e.send()},Program.prototype.loadDOM=function(a,b){var c=this.ctx,d=document.getElementById(b);if(!d)return null;for(var e="",f=d.firstChild;f;)3==f.nodeType&&(e+=f.textContent),f=f.nextSibling;if("x-shader/x-fragment"==d.type)this.fragment_shader=this._compile(c.FRAGMENT_SHADER,e);else{if("x-shader/x-vertex"!=d.type)return null;this.vertex_shader=this._compile(c.VERTEX_SHADER,e)}this._createAttributesAndUniforms(e)},Program.prototype.link=function(){var a=this.ctx;if(this.shaderProgram=a.createProgram(),a.attachShader(this.shaderProgram,this.vertex_shader),a.attachShader(this.shaderProgram,this.fragment_shader),a.linkProgram(this.shaderProgram),!a.getProgramParameter(this.shaderProgram,a.LINK_STATUS))throw new ShaderLinkException("Could not link shaders")},Program.prototype.use=function(){var a=this.ctx;a.useProgram(this.shaderProgram)},Program.prototype.getAttribLocation=function(a){var b=this.ctx;return b.useProgram(this.getID()),b.getAttribLocation(this.getID(),a)},Program.prototype.setUniformLocation=function(a){var b=this.ctx;b.useProgram(this.getID()),this.uniformLocation[a]=b.getUniformLocation(this.getID(),a)},Program.prototype.getUniformLocation=function(a){return this.uniformLocation[a]},Program.prototype.updateUniforms=function(){var a=this.ctx;for(var b in this.uniforms){var c=this.uniforms[b];switch(c.type){case"mat4":a.uniformMatrix4fv(this.getUniformLocation(c.name),!1,c.value);break;case"sampler2D":a.uniform1i(this.getUniformLocation(c.name),c.value);break;case"vec3":a.uniform3fv(this.getUniformLocation(c.name),!1,c.value);break;case"vec4":a.uniform4fv(this.getUniformLocation(c.name),!1,c.value)}}},Program.prototype._compile=function(a,b){var c=this.ctx,d=c.createShader(a);if(c.shaderSource(d,b),c.compileShader(d),!c.getShaderParameter(d,c.COMPILE_STATUS))throw new ShaderCompilationException(c.getShaderInfoLog(d));return d},Program.prototype._createAttributesAndUniforms=function(a){var b,c=a.replace(/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm,""),d=c.split(";"),e=/[\s,;]+/,f="x";for(var g in d){var h=d[g];if(-1!=h.indexOf("attribute")||-1!=h.indexOf("uniform"))for(var i=h.trim().split(e),j=0,k=0;k<i.length;k++)switch(i[k]){case"attribute":f="a";break;case"uniform":f="u";break;case"bool":j=1,b=i[k];break;case"int":j=1,b=i[k];break;case"float":j=1,b=i[k];break;case"sampler2D":j=1,b=i[k];break;case"vec2":j=2,b=i[k];break;case"vec3":j=3,b=i[k];break;case"vec4":j=4,b=i[k];break;case"mat4":j=16,b=i[k];break;default:"a"==f&&""!=i[k]?this.attributes[i[k]]={name:i[k],type:b,size:j}:"u"==f&&""!=i[k]&&(this.uniforms[i[k]]={name:i[k],type:b,size:j})}}};var ShapeFactory=function(){return{get:function(a){console.log(a);var b;switch(a.displayType){case"points":return b=new PointGeometer(a.molecule,ColorFactory.get(a.color)),b.getShape().setProgram(ShaderFactory.get({displayType:"points",glContext:a.glContext})),b.getShape();case"backbone":break;case"ball_sticks":break;case"cartoon":break;case"dots":break;case"spacefill":break;case"ribbons":break;case"sticks":break;case"strands":break;case"trace":break;case"wire":return b=new WireGeometer(a.molecule,ColorFactory.get(a.color)),b.getShape().setProgram(ShaderFactory.get({displayType:"points",glContext:a.glContext})),b.getShape();default:return null}}}}();Cube.prototype=Object.create(mwSG.Shape.prototype),Cube.prototype.setStyle=function(a){switch(a){case"wireframe":this.ID="cubeWire";var b=[0,1,2,3,0,4,5,6,7,4,5,1,2,6,7,3];this.type="LINE_STRIP",this.addVertexData({content:Shape.XYZ,data:Cube.verticesWire,indices:b,attributes:[new Attribute("aVertexPosition",0,0)]}),this.numItems=Cube.verticesWire.length/3;break;case"solid":this.ID="cubeSolid",this.type="TRIANGLES",this.addVertexData({content:Shape.XYZ,data:Cube.vertices,indices:Cube.indices,attributes:[new Attribute("aVertexPosition",0,0)]}),this.addVertexData({content:Shape.RGB,data:Cube.colors,attributes:[new Attribute("aVertexColor",0,0)]}),this.addVertexData({content:Shape.XYZ|Shape.RGBA,data:Cube.vertices,indices:Cube.indices,attributes:[new Attribute("aVertexPosition",0,7),new Attribute("aVertexColor",3,7)]}),this.numItems=Cube.vertices.length/7;break;case"shaded":this.ID="cubeShaded";break;case"textured":this.ID="cubeTextured"}},Cube.verticesWire=[1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,1,-1,1,1],Cube.vertices=[-1,-1,1,1,0,0,1,1,-1,1,1,0,0,1,1,1,1,1,0,0,1,-1,1,1,1,0,0,1,-1,-1,-1,1,1,0,1,-1,1,-1,1,1,0,1,1,1,-1,1,1,0,1,1,-1,-1,1,1,0,1,-1,1,-1,0,1,0,1,-1,1,1,0,1,0,1,1,1,1,0,1,0,1,1,1,-1,0,1,0,1,-1,-1,-1,1,.5,.5,1,1,-1,-1,1,.5,.5,1,1,-1,1,1,.5,.5,1,-1,-1,1,1,.5,.5,1,1,-1,-1,1,0,1,1,1,1,-1,1,0,1,1,1,1,1,1,0,1,1,1,-1,1,1,0,1,1,-1,-1,-1,0,0,1,1,-1,-1,1,0,0,1,1,-1,1,1,0,0,1,1,-1,1,-1,0,0,1,1],Cube.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],EMDBInfoParser.prototype.xmlToJson=function(a){var b={};if(1==a.nodeType){if(a.attributes.length>0){b["@attributes"]={};for(var c=0;c<a.attributes.length;c++){var d=a.attributes.item(c);b["@attributes"][d.nodeName]=d.nodeValue}}}else 3==a.nodeType&&(b=a.nodeValue);if(a.hasChildNodes())for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes.item(e),g=f.nodeName;if("undefined"==typeof b[g])b[g]=this.xmlToJson(f);else{if("undefined"==typeof b[g].push){var h=b[g];b[g]=[],b[g].push(h)}b[g].push(this.xmlToJson(f))}}return b},ImageParser.prototype.getRaster=function(){return this.raster},ImageParser.prototype.parse=function(a){canvas.getContext("2d").getImageData(event.offsetX,event.offsetY,1,1).data},PDBParser.TAGS={ANISOU:0,ATOM:1,AUTHOR:2,CAVEAT:3,CISPEP:4,COMPND:5,CONECT:6,CRYST1:7,DBREF1:8,DBREF2:9,DBREF:10,END:11,ENDMDL:12,EXPDTA:13,FORMUL:14,HEADER:15,HELIX:16,HET:17,HETATM:18,HETNAM:19,HETSYN:20,JRNL:21,KEYWDS:22,LINK:23,MASTER:24,MDLTYP:25,MODEL:26,MODRES:27,MTRIX1:28,MTRIX2:29,MTRIX3:30,NUMMDL:31,OBSLTE:32,ORIGX1:33,ORIGX2:34,ORIGX3:35,REMARK:36,REVDAT:37,SCALE1:38,SCALE2:39,SCALE3:40,SEQADV:41,SEQRES:42,SHEET:43,SITE:44,SOURCE:45,SPLT:46,SPRSDE:47,SSBOND:48,TER:49,TITLE:50},PDBParser.prototype.getStructure=function(){return this.mol},PDBParser.prototype.parse=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++)if(b[c].length>2){var d=PDBParser.TAGS[b[c].substring(0,6).trim()];switch(d){case PDBParser.TAGS.ATOM:case PDBParser.TAGS.HETATM:this.parseAtom(b[c]);break;case PDBParser.TAGS.END:this.postProcess();break;case PDBParser.TAGS.HEADER:this.parseHeader(b[c]);break;case PDBParser.TAGS.HELIX:this.parseHelix(b[c]);break;case PDBParser.TAGS.SHEET:console.log("parse sheet"),this.parseSheet(b[c]);break;case PDBParser.TAGS.TITLE:this.parseTitle(b[c])}}this.mol.centroid.x/=this.mol.atoms.length,this.mol.centroid.y/=this.mol.atoms.length,this.mol.centroid.z/=this.mol.atoms.length,mat4.translate(this.mol.matrix,this.mol.matrix,[-this.mol.centroid.x,-this.mol.centroid.y,-this.mol.centroid.z]),this.mol.bbox.center.x=(this.mol.bbox.min.x+this.mol.bbox.max.x)/2,this.mol.bbox.center.y=(this.mol.bbox.min.y+this.mol.bbox.max.y)/2,this.mol.bbox.center.z=(this.mol.bbox.min.z+this.mol.bbox.max.z)/2,this.mol.bbox.radius=(this.mol.bbox.min.x-this.mol.bbox.max.x)*(this.mol.bbox.min.x-this.mol.bbox.max.x)+(this.mol.bbox.min.y-this.mol.bbox.max.y)*(this.mol.bbox.min.y-this.mol.bbox.max.y)+(this.mol.bbox.min.z-this.mol.bbox.max.z)*(this.mol.bbox.min.z-this.mol.bbox.max.z),this.mol.bbox.radius=Math.sqrt(this.mol.bbox.radius)/2,console.log("centroid "+this.mol.centroid.x+" "+this.mol.centroid.y+" "+this.mol.centroid.z),console.log(this.mol.atoms.length+" "+this.mol.bbox.radius+" "+this.mol.bbox.center.x+" "+this.mol.bbox.center.y+" "+this.mol.bbox.center.z)},PDBParser.prototype.parseAtom=function(a){var b={};b.type=a.substring(0,6).trim(),b.serial=parseInt(a.substring(6,11)),b.name=a.substring(12,16).trim(),b.altLoc=a[16],b.group=a.substring(17,20).trim(),b.chain=a[21],b.groupID=parseInt(a.substring(22,26)),b.x=parseFloat(a.substring(30,38)),b.y=parseFloat(a.substring(38,46)),b.z=parseFloat(a.substring(46,54)),b.symbol=a.substring(76,78).trim(),b.secondary="X";for(var c=0;c<this.secondary.length;)this.secondary[c].initChain===b.chain&&b.groupID>=this.secondary[c].init&&b.groupID<=this.secondary[c].end&&(b.secondary=this.secondary[c].label,c=this.secondary.length),c++;b.label=this.mol.ID+"."+b.chain+"["+b.secondary+"]."+b.group+"["+b.groupID+"]."+b.name+"["+b.serial+"]."+b.type.toLowerCase(),this.mol.atoms.push(b),-1==this.mol.chains.indexOf(b.chain)&&this.mol.chains.push(b.chain),this.mol.centroid.x+=b.x,this.mol.centroid.y+=b.y,this.mol.centroid.z+=b.z,this.updateBBox(b)},PDBParser.prototype.parseHeader=function(a){this.mol.classification=a.substring(10,50).trim(),this.mol.date=a.substring(50,59).trim(),this.mol.ID=a.substring(62,66).trim()},PDBParser.prototype.parseHelix=function(a){this.secondary.push({type:"H",serial:parseInt(a.substring(7,10)),ID:a.substring(11,14).trim(),strand:"",initChain:a[19],init:parseInt(a.substring(21,25)),endChain:a[31],end:parseInt(a.substring(33,37)),"class":Structure.RIGHT_HANDED_ALPHA||parseInt(a.substring(38,40)),label:"H("+a.substring(11,14).trim()+";"+parseInt(a.substring(7,10))+")"})},PDBParser.prototype.parseSheet=function(a){this.secondary.push({type:"E",serial:"x",ID:a.substring(11,14).trim(),strand:parseInt(a.substring(7,10)),initChain:a[21],init:parseInt(a.substring(22,26)),endChain:a[32],end:parseInt(a.substring(33,37)),sense:parseInt(a.substring(38,40)),label:"E"+parseInt(a.substring(7,10))+"("+a.substring(11,14).trim()+";"+parseInt(a.substring(38,40))+")"}),console.log(this.secondary[this.secondary.length-1])},PDBParser.prototype.parseTitle=function(a){1==parseInt(a.substring(8,10).trim())?this.mol.title=a.substring(10,80).trim():this.mol.title=" "+a.substring(10,80).trim()},PDBParser.prototype.updateBBox=function(a){this.mol.bbox.min.x>a.x&&(this.mol.bbox.min.x=a.x),this.mol.bbox.min.y>a.y&&(this.mol.bbox.min.y=a.y),this.mol.bbox.min.z>a.z&&(this.mol.bbox.min.z=a.z),this.mol.bbox.max.x<a.x&&(this.mol.bbox.max.x=a.x),this.mol.bbox.max.y<a.y&&(this.mol.bbox.max.y=a.y),this.mol.bbox.max.z<a.z&&(this.mol.bbox.max.z=a.z)},PDBParser.prototype.postProcess=function(){console.log("PostProcess")},XYZParser.prototype.getStructure=function(){return this.mol},XYZParser.prototype.parse=function(a){var b=a.split("\n");console.log(b);for(var c=0;0==/^\d+$/.test(b[c]);)c++;this.mol.title=b[c+1];for(var d=c+2;d<b.length;d++)void 0!==b[d]&&b[d].length>0&&this.parseAtom(b[d],d-1-c)},XYZParser.prototype.parseAtom=function(a,b){var c=a.match(/(\S+)/g);console.log(c);var d={};d.type="ATOM",d.serial=b,d.name=c[0].trim(),d.group="XXX",d.chain="A",d.groupID=1,d.x=parseFloat(c[1].trim()),d.y=parseFloat(c[2].trim()),d.z=parseFloat(c[3].trim()),d.symbol=d.name,d.secondary="X",this.mol.atoms.push(d),this.mol.cg.x+=d.x,this.mol.cg.y+=d.y,this.mol.cg.z+=d.z,this.updateBBox(d)},XYZParser.prototype.updateBBox=function(a){this.mol.bbox.min.x>a.x&&(this.mol.bbox.min.x=a.x),this.mol.bbox.min.y>a.y&&(this.mol.bbox.min.y=a.y),this.mol.bbox.min.z>a.z&&(this.mol.bbox.min.z=a.z),this.mol.bbox.max.x<a.x&&(this.mol.bbox.max.x=a.x),this.mol.bbox.max.y<a.y&&(this.mol.bbox.max.y=a.y),this.mol.bbox.max.z<a.z&&(this.mol.bbox.max.z=a.z)};var RasterReader=function(){};RasterReader.prototype.getFromDOM=function(a,b){var c=document.getElementById(a),d=document.createElement("mwCanvas2D");d.width=c.width,d.height=c.height,d.getContext("2d").drawImage(c,0,0,c.width,c.height);var e=d.getContext("2d").getImageData(x,y,c.width,c.height).data;return this._createStructure(e,b)},RasterReader.prototype.getFromURL=function(a,b){function c(a,b){var c=document.createElement("mwCanvas2D"),d=c.getContext("2d"),e=new Image;e.src=a,e.onload=function(){d.drawImage(e,0,0,e.width,e.height),this.style.display="none",c.width=this.naturalWidth,c.height=this.naturalHeight;var a=d.getImageData(0,0,this.width,this.height).data;b(a)}}var d=a.split(".").pop().toLowerCase();if(console.log(d),"png"===d||"jpg"===d||"jpeg"===d||"gif"===d)c(a,b);else if(window.XMLHttpRequest){var e=new XMLHttpRequest;e.open("GET",a,!0);var f=this.createStructure;e.onreadystatechange=function(a){if(4==e.readyState)if(200==e.status){var c=f(e.responseText,d);b(c)}else alert("ERROR:: Can't load image/volume file."+a.description+"\n")},e.send(null)}else alert("Please update your browser")},RasterReader.prototype.getFromID=function(a,b){return null},RasterReader.prototype._createStructure=function(a,b){function c(a){}var d=null;"png"===b?d=new PDBParser:"jpg"===b?d=new MMCIFParser:"xml"===b?d=new PDBMLParser:"xyz"===b&&(d=new XYZParser),d.parse(text);var e=d.getStructure();return c(e),e};var StructureReader=function(){};StructureReader.prototype.getFromDOM=function(a,b){var c=document.getElementById(a).innerHTML,d=this.createStructure(c,b);return d},StructureReader.prototype.getFromURL=function(a,b){var c=a.split(".").pop().toLowerCase();if(console.log(c),window.XMLHttpRequest){var d=new XMLHttpRequest;d.open("GET",a,!0);var e=this.createStructure;d.onreadystatechange=function(a){if(4==d.readyState)if(200==d.status){var f=e(d.responseText,c);b(f)}else console.log("ERROR:: Can't download PDB file."+a.description+"\n")},d.send(null)}else alert("Please update your browser")},StructureReader.prototype.getFromID=function(a,b){return this.getFromURL("http://www.rcsb.org/pdb/files/"+a+".pdb",b)},StructureReader.prototype.createStructure=function(a,b){function c(a){}var d=null;"pdb"===b?d=new PDBParser:"cif"===b?d=new MMCIFParser:"xml"===b?d=new PDBMLParser:"xyz"===b&&(d=new XYZParser),d.parse(a);var e=d.getStructure();return c(e),e},IsoCube.prototype.getVertex=function(a){switch(a){case 0:return{x:this.x,y:this.y,z:this.z,voxel:this.voxels[0]};case 1:return{x:this.x+this.size,y:this.y,z:this.z,voxel:this.voxels[1]};case 2:return{x:this.x+this.size,y:this.y+this.size,z:this.z,voxel:this.voxels[2]};case 3:return{x:this.x,y:this.y+this.size,z:this.z,voxel:this.voxels[3]};case 4:return{x:this.x,y:this.y,z:this.z+this.size,voxel:this.voxels[4]};case 5:return{x:this.x+this.size,y:this.y,z:this.z+this.size,voxel:this.voxels[5]};case 6:return{x:this.x+this.size,y:this.y+this.size,z:this.z+this.size,voxel:this.voxels[6]};case 7:return{x:this.x,y:this.y+this.size,z:this.z+this.size,voxel:this.voxels[7]}}},IsoCube.prototype.setVoxels=function(a){this.voxels[0]=a.getVoxel(this.x,this.y,this.z),this.voxels[1]=a.getVoxel(this.x+this.size,this.y,this.z),this.voxels[2]=a.getVoxel(this.x+this.size,this.y+this.size,this.z),this.voxels[3]=a.getVoxel(this.x,this.y+this.size,this.z),this.voxels[4]=a.getVoxel(this.x,this.y,this.z+this.size),this.voxels[5]=a.getVoxel(this.x+this.size,this.y,this.z+this.size),this.voxels[6]=a.getVoxel(this.x+this.size,this.y+this.size,this.z+this.size),this.voxels[7]=a.getVoxel(this.x,this.y+this.size,this.z+this.size)},IsoCube.prototype.calcKey=function(a){var b="";b+=this.voxels[7]>a?"1":"0",b+=this.voxels[6]>a?"1":"0",b+=this.voxels[5]>a?"1":"0",b+=this.voxels[4]>a?"1":"0",b+=this.voxels[3]>a?"1":"0",b+=this.voxels[2]>a?"1":"0",b+=this.voxels[1]>a?"1":"0",b+=this.voxels[0]>a?"1":"0",this.key=parseInt(b,2)},IsoCube.prototype.toString=function(){for(var a="[",b=0;12>b;b++)a+=this.edges[b]+"; ";return"Cube["+this.key+"]=("+this.x+" "+this.y+" "+this.z+") "+a+"]"},IsoSlice.prototype.reset_count=function(){this.count=0},IsoSlice.prototype.push=function(a){this.cubes[this.count++]=a},IsoSlice.prototype.previous=function(){return this.cubes[this.count-1]},IsoSlice.prototype.above=function(){return this.cubes[this.count-this.w]},IsoSlice.prototype.back=function(){return this.cubes[this.count]},IsoSurfacer.prototype.setInterpolation=function(a){function b(a,b){var c=(a.x+b.x)/2,d=(a.y+b.y)/2,e=(a.z+b.z)/2;return{x:c,y:d,z:e}}function c(a,b){var c=(this.threshold-a.voxel)/(b.voxel-a.voxel),d=a.x+(b.x-a.x)*c,e=a.y+(b.y-a.y)*c,f=a.z+(b.z-a.z)*c;return{x:d,y:e,z:f}}"None"===a?this.interpolate=b:"Bilinear"===a&&(this.interpolate=c)},IsoSurfacer.prototype.getMesh=function(){return this.mesh},IsoSurfacer.prototype.compute=function(a){function b(a){for(var b=null,d=IsoSurfacer.triangles[a.key],e=0;e<d.length;e++){var f=-1,g=d[e];if(-1!=a.edges[g])f=a.edges[g];else switch(g){case 0:0!=a.y?(a.edges[g]=c.above().edges[2],f=a.edges[g]):(b=this.interpolate(a.getVertex(0),a.getVertex(1)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 1:0!=a.z?(a.edges[g]=c.back().edges[5],f=a.edges[g]):(b=this.interpolate(a.getVertex(1),a.getVertex(2)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 2:0!=a.z?(a.edges[g]=c.back().edges[6],f=a.edges[g]):(b=this.interpolate(a.getVertex(2),a.getVertex(3)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 3:0!=a.x?(a.edges[g]=c.previous().edges[1],f=a.edges[g]):(b=this.interpolate(a.getVertex(0),a.getVertex(3)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 4:0!=a.y?(a.edges[g]=c.above().edges[6],f=a.edges[g]):(b=this.interpolate(a.getVertex(4),a.getVertex(5)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 5:b=this.interpolate(a.getVertex(5),a.getVertex(6)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f;break;case 6:b=this.interpolate(a.getVertex(6),a.getVertex(7)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f;break;case 7:0!=a.x?(a.edges[g]=c.previous().edges[5],f=a.edges[g]):(b=this.interpolate(a.getVertex(4),a.getVertex(7)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 8:0!=a.x?(a.edges[g]=c.previous().edges[9],f=a.edges[g]):(b=this.interpolate(a.getVertex(0),a.getvertex(4)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 9:0!=a.y?(a.edges[g]=c.above().edges[11],f=a.edges[g]):(b=this.interpolate(a.getVertex(1),a.getVertex(5)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 10:0!=a.x?(a.edges[g]=c.previous().edges[11],f=a.edges[g]):(b=this.interpolate(a.getVertex(3),a.getVertex(7)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f);break;case 11:b=this.interpolate(a.getVertex(2),a.getVertex(6)),this.mesh.vertices.push(b),f=this.mesh.vertices.length-1,a.edges[g]=f}this.mesh.faces.push(f)}}var c=new IsoSlice(Math.floor((d-1)/this.cubeSize),Math.floor((e-1)/this.cubeSize)),d=this.map.width,e=this.map.height,f=this.map.depth;console.log("Start of the main loop... Please wait.");for(var g=0;g<f-this.cubeSize;g+=this.cubeSize){c.reset_count();for(var h=0;h<e-this.cubeSize;h+=this.cubeSize)for(var i=0;i<d-this.cubeSize;i+=this.cubeSize){var j=new IsoCube(i,h,g,this.cubeSize);j.setVoxels(this.map.data),j.calcKey(a),0!=j.key&&255!=j.key&&b(j),c.push(j)}g%10==0&&console.log("z="+g)}},IsoSurfacer.triangles=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,11],[0,8,3,1,2,11],[9,2,11,0,2,9],[2,8,3,2,11,8,11,9,8],[3,10,2],[0,10,2,8,10,0],[1,9,0,2,3,10],[1,10,2,1,9,10,9,8,10],[3,11,1,10,11,3],[0,11,1,0,8,11,8,10,11],[3,9,0,3,10,9,10,11,9],[9,8,11,11,8,10],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,11,8,4,7],[3,4,7,3,0,4,1,2,11],[9,2,11,9,0,2,8,4,7],[2,11,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,10,2],[10,4,7,10,2,4,2,0,4],[9,0,1,8,4,7,2,3,10],[4,7,10,9,4,10,9,10,2,9,2,1],[3,11,1,3,10,11,7,8,4],[1,10,11,1,4,10,1,0,4,7,10,4],[4,7,8,9,0,10,9,10,11,10,0,3],[4,7,10,4,10,9,9,10,11],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,11,9,5,4],[3,0,8,1,2,11,4,9,5],[5,2,11,5,4,2,4,0,2],[2,11,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,10],[0,10,2,0,8,10,4,9,5],[0,5,4,0,1,5,2,3,10],[2,1,5,2,5,8,2,8,10,4,8,5],[11,3,10,11,1,3,9,5,4],[4,9,5,0,8,1,8,11,1,8,10,11],[5,4,0,5,0,10,5,10,11,10,0,3],[5,4,8,5,8,11,11,8,10],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,11,1,2],[11,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,11,5,2],[2,11,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,10,2],[9,5,7,9,7,2,9,2,0,2,7,10],[2,3,10,0,1,8,1,7,8,1,5,7],[10,2,1,10,1,7,7,1,5],[9,5,8,8,5,7,11,1,3,11,3,10],[5,7,0,5,0,9,7,10,0,1,0,11,10,11,0],[10,11,0,10,0,3,11,5,0,8,0,7,5,7,0],[10,11,5,7,10,5],[11,6,5],[0,8,3,5,11,6],[9,0,1,5,11,6],[1,8,3,1,9,8,5,11,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,10,11,6,5],[10,0,8,10,2,0,11,6,5],[0,1,9,2,3,10,5,11,6],[5,11,6,1,9,2,9,10,2,9,8,10],[6,3,10,6,5,3,5,1,3],[0,8,10,0,10,5,0,5,1,5,10,6],[3,10,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,10,10,9,8],[5,11,6,4,7,8],[4,3,0,4,7,3,6,5,11],[1,9,0,5,11,6,8,4,7],[11,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,10,2,7,8,4,11,6,5],[5,11,6,4,7,2,4,2,0,2,7,10],[0,1,9,4,7,8,2,3,10,5,11,6],[9,2,1,9,10,2,9,4,10,7,10,4,5,11,6],[8,4,7,3,10,5,3,5,1,5,10,6],[5,1,10,5,10,6,1,0,10,7,10,4,0,4,10],[0,5,9,0,6,5,0,3,6,10,6,3,8,4,7],[6,5,9,6,9,10,4,7,9,7,10,9],[11,4,9,6,4,11],[4,11,6,4,9,11,0,8,3],[11,0,1,11,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,11],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[11,4,9,11,6,4,10,2,3],[0,8,2,2,8,10,4,9,11,4,11,6],[3,10,2,0,1,6,0,6,4,6,1,11],[6,4,1,6,1,11,4,8,1,2,1,10,8,10,1],[9,6,4,9,3,6,9,1,3,10,6,3],[8,10,1,8,1,0,10,6,1,9,1,4,6,4,1],[3,10,6,3,6,0,0,6,4],[6,4,8,10,6,8],[7,11,6,7,8,11,8,9,11],[0,7,3,0,11,7,0,9,11,6,7,11],[11,6,7,1,11,7,1,7,8,1,8,0],[11,6,7,11,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,10,11,6,8,11,8,9,8,6,7],[2,0,7,2,7,10,0,9,7,6,7,11,9,11,7],[1,8,0,1,7,8,1,11,7,6,7,11,2,3,10],[10,2,1,10,1,7,11,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,10,6,3,1,3,6],[0,9,1,10,6,7],[7,8,0,7,0,6,3,10,0,10,6,0],[7,10,6],[7,6,10],[3,0,8,10,7,6],[0,1,9,10,7,6],[8,1,9,8,3,1,10,7,6],[11,1,2,6,10,7],[1,2,11,3,0,8,6,10,7],[2,9,0,2,11,9,6,10,7],[6,10,7,2,11,3,11,8,3,11,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[11,7,6,11,1,7,1,3,7],[11,7,6,1,7,11,1,8,7,1,0,8],[0,3,7,0,7,11,0,11,9,6,11,7],[7,6,11,7,11,8,8,11,9],[6,8,4,10,8,6],[3,6,10,3,0,6,0,4,6],[8,6,10,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,10,3,6],[6,8,4,6,10,8,2,11,1],[1,2,11,3,0,10,0,6,10,0,4,6],[4,10,8,4,6,10,0,2,9,2,11,9],[11,9,3,11,3,2,9,4,3,10,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,11,1],[11,1,0,11,0,6,6,0,4],[4,6,3,4,3,8,6,11,3,0,3,9,11,9,3],[11,9,4,6,11,4],[4,9,5,7,6,10],[0,8,3,4,9,5,10,7,6],[5,0,1,5,4,0,7,6,10],[10,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,11,1,2,7,6,10],[6,10,7,1,2,11,0,8,3,4,9,5],[7,6,10,5,4,11,4,2,11,4,0,2],[3,4,8,3,5,4,3,2,5,11,5,2,10,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,11,1,6,1,7,6,1,3,7],[1,6,11,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,11,4,11,5,0,3,11,6,11,7,3,7,11],[7,6,11,7,11,8,5,4,11,4,8,11],[6,9,5,6,10,9,10,8,9],[3,6,10,0,6,3,0,5,6,0,9,5],[0,10,8,0,5,10,0,1,5,5,6,10],[6,10,3,6,3,5,5,3,1],[1,2,11,9,5,10,9,10,8,10,5,6],[0,10,3,0,6,10,0,9,6,5,6,9,1,2,11],[10,8,5,10,5,6,8,0,5,11,5,2,0,2,5],[6,10,3,6,3,5,2,11,3,11,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,11,3,8,6,5,6,9,8,9,6],[11,1,0,11,0,6,9,5,0,5,6,0],[0,3,8,5,6,11],[11,5,6],[10,5,11,7,5,10],[10,5,11,10,7,5,8,3,0],[5,10,7,5,11,10,1,9,0],[11,7,5,11,10,7,9,8,1,8,3,1],[10,1,2,10,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,10],[9,7,5,9,2,7,9,0,2,2,10,7],[7,5,2,7,2,10,5,9,2,3,2,8,9,8,2],[2,5,11,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,11,2,5],[9,0,1,5,11,3,5,3,7,3,11,2],[9,8,2,9,2,1,8,7,2,11,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,11,8,11,10,8],[5,0,4,5,10,0,5,11,10,10,3,0],[0,1,9,8,4,11,8,11,10,11,4,5],[11,10,4,11,4,5,10,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,10,8,4,5,8],[0,4,10,0,10,3,4,5,10,2,10,1,5,1,10],[0,2,5,0,5,9,2,10,5,4,5,8,10,8,5],[9,4,5,2,10,3],[2,5,11,3,5,2,3,4,5,3,8,4],[5,11,2,5,2,4,4,2,0],[3,11,2,3,5,11,3,8,5,4,5,8,0,1,9],[5,11,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,10,7,4,9,10,9,11,10],[0,8,3,4,9,7,9,10,7,9,11,10],[1,11,10,1,10,4,1,4,0,7,4,10],[3,1,4,3,4,8,1,11,4,7,4,10,11,10,4],[4,10,7,9,10,4,9,2,10,9,1,2],[9,7,4,9,10,7,9,1,10,2,10,1,0,8,3],[10,7,4,10,4,2,2,4,0],[10,7,4,10,4,2,8,3,4,3,2,4],[2,9,11,2,7,9,2,3,7,7,4,9],[9,11,7,9,7,4,11,2,7,8,7,0,2,0,7],[3,7,11,3,11,2,7,4,11,1,11,0,4,0,11],[1,11,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,11,8,11,10,8],[3,0,9,3,9,10,10,9,11],[0,1,11,0,11,8,8,11,10],[3,1,11,10,3,11],[1,2,10,1,10,9,9,10,8],[3,0,9,3,9,10,1,2,9,2,10,9],[0,2,10,8,0,10],[3,2,10],[2,3,8,2,8,11,11,8,9],[9,11,2,0,9,2],[2,3,8,2,8,11,0,1,8,1,11,8],[1,11,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],
Bond.NONE=0,Bond.COVALENT=1,Bond.SSBOND=2,Bond.HBOND=4;var MowgliViewer=function(a){this.renderer=new Renderer(a),this.scene=new Scene,this.renderer.addScene(scene),this.renderer.update();var b=new MouseSensor(a);this.mouse.attach(this.scene),this.renderer.addSensor(b)};MowgliViewer.prototype.getScene=function(){return this.scene},MowgliViewer.prototype.render=function(){this.renderer.drawScene()},Molecule.prototype=Object.create(Structure.prototype),Molecule.RIGHT_HANDED_ALPHA=1,Molecule.RIGHT_HANDED_OMEGA=2,Molecule.RIGHT_HANDED_PI=3,Molecule.RIGHT_HANDED_GAMMA=4,Molecule.RIGHT_HANDED_3_10=5,Molecule.LEFT_HANDED_ALPHA=6,Molecule.LEFT_HANDED_OMEGA=7,Molecule.LEFT_HANDED_GAMMA=8,Molecule.RIBBON_HELIX_2_7=9,Molecule.POLYPROLINE=10,Molecule.threeToOne={ALA:"A",ARG:"R",ASN:"N",ASP:"D",CYS:"C",GLU:"E",GLN:"Q",GLY:"G",HIS:"H",ILE:"I",LEU:"L",LYS:"K",MET:"M",PHE:"F",PRO:"P",SER:"S",THR:"T",TRP:"W",TYR:"Y",VAL:"V",SEC:"U",PYL:"O",ASX:"B",GLX:"Z",XLE:"J",XAA:"X",XXX:"X",A:"a",T:"t",G:"g",C:"c",U:"u",DA:"a",DT:"t",DG:"g",DC:"c"},Molecule.prototype.getAtomByLabel=function(a){var b,c=a.replace(/([.\[\]])/g,"\\$1");c=c.replace(/\*/g,".+"),console.log(c);for(var d=new RegExp(c,"i"),e=0,f=!1;!f&&e<this.atoms.length;)f=d.test(this.atoms[e].label),f&&(b=this.atoms[e]),e++;return b},Molecule.prototype.finder=function(a,b){return"ATOM"===a?this.atoms.filter(b):this.bonds.filter(b)},Molecule.prototype.atomFinder=function(a){return this.atoms.filter(a)},Molecule.prototype.bondFinder=function(a){return this.bonds.filter(a)},Molecule.prototype.fasta=function(){for(var a="> "+this.ID+":"+this.atoms[0].chain+"| "+this.information.title+"\n",b=this.atoms[0].chain,c=0,d=0;d<this.atoms.length;d++)this.atoms[d].chain!=b&&"ATOM"===this.atoms[d].type&&(a+="\n> "+this.ID+":"+this.atoms[d].chain+"| "+this.information.title+"\n",b=this.atoms[d].chain,c=0),"CA"!==this.atoms[d].name&&"O4*"!==this.atoms[d].name&&"O4'"!==this.atoms[d].name||this.atoms[d].chain!=b||(a+=Molecule.threeToOne[this.atoms[d].group],c++,c%80==0&&(a+="\n",c=0));return a},Molecule.prototype.secondary=function(){for(var a="> "+this.ID+":"+this.atoms[0].chain+"| "+this.information.title+"\n",b=this.atoms[0].chain,c=0,d=0;d<this.atoms.length;d++)"X"===this.atoms[d].secondary&&(this.atoms[d].secondary="."),this.atoms[d].chain!=b&&"ATOM"===this.atoms[d].type&&(a+="\n> "+this.ID+":"+this.atoms[d].chain+"| "+this.information.title+"\n",b=this.atoms[d].chain,c=0),"CA"!==this.atoms[d].name&&"O4*"!==this.atoms[d].name&&"O4'"!==this.atoms[d].name||this.atoms[d].chain!=b||(a+=this.atoms[d].secondary[0],c++,c%80==0&&(fasta+="\n",c=0));return a},Molecule.prototype.calcPhiPsi=function(){function a(a){var c=b(a[0],a[1],a[2],a[3]),d=b(a[2],a[3],a[4],a[5]);return[d,c]}function b(a,b,c,d){var e=vec3.fromValues(b.x-a.x,b.y-a.y,b.z-a.z),f=vec3.fromValues(c.x-b.x,c.y-b.y,c.z-b.z),g=vec3.fromValues(d.x-c.x,d.y-c.y,d.z-c.z),h=vec3.create(),i=vec3.create();vec3.cross(h,e,f),vec3.cross(i,f,g);var j=vec3.dot(e,i)*vec3.length(f),k=vec3.dot(h,i);return Math.atan2(j,k)/Math.PI*180}var c=0,d=0,e=[],f={N:0,CA:1,C:2},g=0,h=0,i=" ",j=void 0;for(var k in this.atoms)if(this.atoms[k].chain!=i&&(" "!=i&&(this.atoms[c].phi=j,this.atoms[c].psi=void 0),j=void 0,h=this.atoms[k].groupID,i=this.atoms[k].chain,g=0),this.atoms[k].chain==i&&this.atoms[k].groupID>=h&&this.atoms[k].groupID<=h+1&&("N"===this.atoms[k].name||"CA"===this.atoms[k].name||"C"===this.atoms[k].name)){var l=3*(this.atoms[k].groupID-h)+f[this.atoms[k].name];1==l?c=k:4==l&&(d=k),e[l]=this.atoms[k],g++}else if(6==g){var m=a(e);this.atoms[c].phi=j,this.atoms[c].psi=m[1],j=m[0],h=e[g-1].groupID,c=d,e[0]=e[3],e[1]=e[4],e[2]=e[5],g=3}this.atoms[c].phi=j,this.atoms[c].psi=void 0},Molecule.prototype.calcBonds=function(){new BondCalculator(this)},Molecule.prototype.toString=function(){var a="{\n";for(var b in this.atoms)a+="{",a+="type: '"+this.atoms[b].type+"', serial: "+this.atoms[b].serial+", name: '"+this.atoms[b].name+"', struct:'"+this.atoms[b].struct+"', x :"+this.atoms[b].x+", y :"+this.atoms[b].y+", z :"+this.atoms[b].z+", symbol:'"+this.atoms[b].symbol+"'},\n ";return a+="center: {"+this.cg.x+",y: "+this.cg.y+",z: "+this.cg.z+"} } ",a+="}\n"},Raster.prototype=Object.create(Structure.prototype),Raster.prototype.getPixel=function(a,b){return this.data(a+this.width*b)},Raster.prototype.getVoxel=function(a,b,c){return this.data(a+this.width*b+this.width*this.height*c)},Raster.prototype.histogram=function(){if(void 0===this.bins){this.bins=[];for(var a=0;a<this.data.length;a++)this.bins[this.data[a]]++}return this.bins},Structure.prototype.isMolecule=function(){return this instanceof Molecule},Structure.prototype.isRaster=function(){return this instanceof Raster},Structure.prototype.setTitle=function(a){this.information.title=a},VecObj.prototype=Object.create(Structure.prototype),EventManager.prototype.add=function(a,b){},function(a){function b(a){var b=[0,0],c=[0,0],d=-1,e=-1,f=!1,g=document.getElementById(a),h=[],i=null;return g.onmousedown=function(a){var c=a.clientX,h=a.clientY,i=a.target.getBoundingClientRect();i.left<=c&&c<=i.right&&i.top<=h&&h<=i.bottom&&(d=c,e=h,b[0]=c,b[1]=g.height-h,f=!0)},g.onmouseup=function(a){f=!1},g.onmousemove=function(a){var j=a.clientX,k=a.clientY;if(f){var l=.05,m=l*(j-d),n=l*(k-e);c[0]=Math.max(Math.min(c[0]+n,90),-90),c[1]=c[1]+m,b[0]=j,b[1]=g.height-k;var o=mat4.create();mat4.identity(o),mat4.rotate(o,o,m,[0,1,0]),mat4.rotate(o,o,n,[1,0,0]);for(var p in h)mat4.multiply(h[p].matrix,o,h[p].matrix);i.drawScene()}d=j,e=k},{attach:function(a){h.push(a)},setRenderer:function(a){i=a}}}a.MouseSensor=b}(this.mwUI=this.mwUI||{}),function(a){function b(a){this.nodes=[],this.zoom=1,this.zoomDelta=.05,this.canvas=document.getElementById(a),this.handleEvent=function(a){this.zoom+=this.zoomDelta*a.deltaY/Math.abs(a.deltaY);for(var b=0;b<this.nodes.length;b++)this.nodes[b].setZoom(this.zoom);return this.nodes[0].getRenderer().drawScene(),a.preventDefault(),!1},this.canvas.addEventListener("wheel",this,!1)}b.prototype.attach=function(a){a instanceof mwSG.Camera&&this.nodes.push(a)},a.ZoomSensor=b}(this.mwUI=this.mwUI||{});