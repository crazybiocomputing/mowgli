/*! mowgli 2016-04-08 */
"use strict";function Alert(a){document.querySelector("#alert header #body").innerHTML="<p>Alert!!</p>";var b=document.querySelector("#alert article");b.innerHTML="<p>"+a+"</p>",document.getElementById("alert").classList.toggle("alert_target")}function CheckBox(a){}function Modal(a){var b=document.querySelector(".mwModal .modal-header");b.style.backgroundImage=a.headerImage||'url("images/default-background.jpg")',document.querySelector(".mwModal .modal-header h2").innerHTML=a.headerTitle||"Modal window";var c=document.querySelector(".mwModal .modal-body");c.innerHTML=a.body||"<p>No information</p>",c.style.fontSize=a.fontSize||"1.1em",c.style.fontFamily=a.fontFamily||"Lato",document.querySelector(".mwModal #modal-one").checked=!0}function Molecule(a){Structure.call(this,a),this.information.classification=a.classification||"Unknown",this.atoms=a.atoms||[],this.bonds=[],this.colors=[],this.chains=a.chains||[]}!function(a){a.alert=function(a){document.querySelector(".alert .modal-header h2").innerHTML="MOWGLI: Info",document.querySelector(".alert .modal-body").innerHTML="<p>"+a+"</p>",document.querySelector(".alert #modal-alert").checked=!0},a.structure=void 0}(this.MOWGLI={}),CheckBox.prototype.update=function(a,b){for(var c=a.parentNode,d=0;d<c.children.length;d++)c.children[d].children[0].dataset.value===b?c.children[d].className="checked":c.children[d].className="checkbox_item"},window.onload=function(){new mwGUI.Sample("1zni"),new mwGUI.Sample("3cro"),new mwGUI.Sample("toricSolenoid.png"),new mwGUI.SaveAs("export"),new mwGUI.Fasta("fasta"),new mwGUI.SecStruct("secstruct"),new mwGUI.Phipsi("phipsi"),new mwGUI.FullScreen("fullscreen"),new mwGUI.Camera("camera");console.log("Add event click on About...");new mwGUI.About("about")},function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(c){switch(console.log(a),c.type){case"click":new Modal({headerTitle:"About Mowgli...",headerImage:"url('images/headprot.jpg')",body:b.reduce(function(a,b,c,d){return a+b})});break;case"dblclick":}},this.element.addEventListener("click",this,!1),this.element.addEventListener("dblclick",this,!1);var b=["<p>MOWGLI &mdash; <b>MO</b>lecule <b>W</b>eb<b>GL</b> & <b>I</b>mage viewer &mdash; ","is a collaborative project developed by students of the Master of Science in Bioinformatics, Bordeaux ",'during the course "Structural Bioinformatics". </p>',"<p>Maintained and supervised by Jean-Christophe Taveau</a></p>","<h3>Contributors</h3>","<h4>Promotion 2014</h4>","<p>Nullam at enim at nibh mollis feugiat ac nec lorem. Mauris eu ornare erat. Integer facilisis aliquet leo a iaculis. </p>","<h4>Promotion 2015</h4>","<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In lobortis orci vel velit rutrum, a dapibus nisl convallis. ","Nulla quis hendrerit dui. Lorem ipsum dolor sit amet, consectetur adipiscing elit. </p>","<h4>Promotion 2016</h4>","<p>Integer commodo faucibus dui vitae maximus. Nullam at enim at nibh mollis feugiat ac nec lorem. Mauris eu ornare erat. </p>",'<p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>']}a.About=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.checkbox=new CheckBox(a),this.handleEvent=function(a){switch(a.type){case"click":var b=a.target.dataset.value;"cam_anaglyph"===b?console.log("cam_anaglyph"):"cam_cross"===b?console.log("cam_cross"):"cam_mono"===b?console.log("cam_mono"):console.log("cam_stereo"),this.checkbox.update(a.target.parentNode,b)}},this.element.addEventListener("click",this,!1)}a.Camera=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(b){switch(console.log(a),b.type){case"click":var c;if(MOWGLI.structure.isMolecule()){c=MOWGLI.structure.fasta();new Modal({headerTitle:"FASTA Sequence",headerImage:"url('images/headprot.jpg')",body:"<pre>"+c+"</pre>"})}else MOWGLI.alert("No FASTA sequence is available for this structure");break;case"dblclick":}},this.element.addEventListener("click",this,!1),this.element.addEventListener("dblclick",this,!1)}a.Fasta=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(a){function b(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}switch(a.type){case"click":b()}},this.element.addEventListener("click",this,!1)}a.FullScreen=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(b){switch(console.log(a),b.type){case"click":if(MOWGLI.structure.isMolecule()){MOWGLI.structure.calcPhiPsi();var c=MOWGLI.structure.finder("ATOM",function(a){return"CA"===a.name?!0:void 0}),d=function(a){var b='<table id="tabphi">';b+="<tr><th>Chain</th><th>Group</th><th>GroupID</th><th>Phi</th><th>Psi</th></tr>";for(var d=0;d<c.length;d++)b+="<tr><td>"+c[d].chain+"</td><td>"+c[d].group+"</td><td>"+c[d].groupID+"</td><td>"+c[d].phi+"</td><td>"+c[d].psi+"</td></tr>";return b+="</table>",b=b.replace(/undefined/g,"-")},e=d(c);new Modal({headerTitle:"Phi/Psi...",headerImage:"url('images/headprot.jpg')",body:e})}else MOWGLI.alert("No Phi/Psi angles are available for this structure");break;case"dblclick":}},this.element.addEventListener("click",this,!1),this.element.addEventListener("dblclick",this,!1)}a.Phipsi=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(b){function c(b){var c=new XMLHttpRequest;c.open("GET",b,!0),c.responseType="json",c.onreadystatechange=function(b){if(4==c.readyState)if(200==c.status){var d=c.response;MOWGLI.structure=new Molecule(d),MOWGLI.alert(a.toUpperCase()+" successfully loaded..."),console.log(MOWGLI.structure instanceof Molecule),MOWGLI.structure.calcPhiPsi()}else console.log("ERROR:: Can't load sample."+b.description+"\n")},c.send(null)}function d(b,c,d){console.log("Load Raster...");var e=document.createElement("canvas"),f=e.getContext("2d"),g=new Image;g.src=b,g.crossOrigin="*",g.onload=function(){e.style.display="none",e.width=this.width,e.height=this.height,f.drawImage(g,0,0,this.width,this.height);var b,h=f.getImageData(0,0,this.width,this.height).data;if("8-bit"===c){b=new Uint8ClampedArray(h.length/4);for(var i=0,j=0;i<h.length;i+=4,j++)b[j]=h[i]}else{b=new Uint32Array(h.length/4);for(var i=0,j=0;i<h.length;i+=4,j++)b[j]=h[i]<<24|h[i+1]<<16|h[i+2]<<8|h[i+3]}MOWGLI.structure=new Raster({ID:d,title:d,mode:c,width:this.width,height:this.width,depth:this.height/this.width,data:b}),MOWGLI.alert(a.toUpperCase()+" successfully loaded...")}}switch(b.type){case"click":console.log("Load Sample..."+a);var e="samples/1ZNI.json";switch(a){case"1zni":e="samples/1ZNI.json",c(e);break;case"1hho":e="samples/1HHO.json",c(e);break;case"3cro":e="samples/3CRO.json",c(e);break;case"toricSolenoid.png":e="samples/toricSolenoid_vertical_128x128x86.png",d(e,"8-bit","toricSolenoid")}}},this.element.addEventListener("click",this,!1)}a.Sample=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(b){switch(console.log(a),b.type){case"click":MOWGLI.alert("Not implemented. Sorry for the inconvenience")}},this.element.addEventListener("click",this,!1)}a.SaveAs=b}(this.mwGUI=this.mwGUI||{}),function(a){function b(a){this.element=document.getElementById(a),this.handleEvent=function(b){switch(console.log(a),b.type){case"click":if(MOWGLI.structure.isMolecule()){MOWGLI.structure.secondary();var c=MOWGLI.structure.finder("ATOM",function(a){return"CA"===a.name?!0:void 0});console.log(c);var d=function(a){for(var b="Secondary structures without sequence \n",d=0;d<c.length;d++)d%10==0&&(b+=" "),d%50==0&&(b+="\n"),b+="X"==c[d].secondary[0]?".":c[d].secondary[0];return b},e=d(c);new Modal({headerTitle:"Secondary structure...",headerImage:"url('images/headprot.jpg')",body:"<pre>"+e+"</pre>"})}else MOWGLI.alert("No Secondary Structure are available for this structure");break;case"dblclick":}},this.element.addEventListener("click",this,!1),this.element.addEventListener("dblclick",this,!1)}a.SecStruct=b}(this.mwGUI=this.mwGUI||{}),Molecule.prototype=Object.create(Structure.prototype),Molecule.RIGHT_HANDED_ALPHA=1,Molecule.RIGHT_HANDED_OMEGA=2,Molecule.RIGHT_HANDED_PI=3,Molecule.RIGHT_HANDED_GAMMA=4,Molecule.RIGHT_HANDED_3_10=5,Molecule.LEFT_HANDED_ALPHA=6,Molecule.LEFT_HANDED_OMEGA=7,Molecule.LEFT_HANDED_GAMMA=8,Molecule.RIBBON_HELIX_2_7=9,Molecule.POLYPROLINE=10,Molecule.threeToOne={ALA:"A",ARG:"R",ASN:"N",ASP:"D",CYS:"C",GLU:"E",GLN:"Q",GLY:"G",HIS:"H",ILE:"I",LEU:"L",LYS:"K",MET:"M",PHE:"F",PRO:"P",SER:"S",THR:"T",TRP:"W",TYR:"Y",VAL:"V",SEC:"U",PYL:"O",ASX:"B",GLX:"Z",XLE:"J",XAA:"X",XXX:"X",A:"a",T:"t",G:"g",C:"c",U:"u",DA:"a",DT:"t",DG:"g",DC:"c"},Molecule.prototype.getAtomByLabel=function(a){var b,c=a.replace(/([.\[\]])/g,"\\$1");c=c.replace(/\*/g,".+"),console.log(c);for(var d=new RegExp(c,"i"),e=0,f=!1;!f&&e<this.atoms.length;)f=d.test(this.atoms[e].label),f&&(b=this.atoms[e]),e++;return b},Molecule.prototype.finder=function(a,b){return"ATOM"===a?this.atoms.filter(b):this.bonds.filter(b)},Molecule.prototype.atomFinder=function(a){return this.atoms.filter(a)},Molecule.prototype.bondFinder=function(a){return this.bonds.filter(a)},Molecule.prototype.fasta=function(){for(var a="> "+this.ID+":"+this.atoms[0].chain+" | "+this.information.title+"\n",b=this.atoms[0].chain,c=0,d=0;d<this.atoms.length;d++)console.log(this.atoms[d].chain+" "+b),this.atoms[d].chain!=b&&"ATOM"===this.atoms[d].type&&(a+="\n> "+this.ID+":"+this.atoms[d].chain+" | "+this.information.title+"\n",b=this.atoms[d].chain,c=0),"CA"!==this.atoms[d].name&&"O4*"!==this.atoms[d].name&&"O4'"!==this.atoms[d].name||this.atoms[d].chain!=b||(a+=Molecule.threeToOne[this.atoms[d].group],c++,c%80==0&&(a+="\n",c=0));return a},Molecule.prototype.secondary=function(){for(var a="> "+this.ID+":"+this.atoms[0].chain+" | "+this.title+"\n",b=this.atoms[0].chainID,c=0,d=0;d<this.atoms.length;d++)this.atoms[d].chainID!=b&&(a+="\n> "+this.ID+":"+this.atoms[d].chain+" | "+this.title+"\n",b=this.atoms[d].chainID,c=0),"CA"===this.atoms[d].name&&this.atoms[d].chainID==b&&(a+=this.atoms[d].secondary,c++,c%80==0&&(a+="\n",c=0))},Molecule.prototype.calcPhiPsi=function(){function a(a){var c=b(a[0],a[1],a[2],a[3]),d=b(a[2],a[3],a[4],a[5]);return[d,c]}function b(a,b,c,d){var e=vec3.fromValues(b.x-a.x,b.y-a.y,b.z-a.z),f=vec3.fromValues(c.x-b.x,c.y-b.y,c.z-b.z),g=vec3.fromValues(d.x-c.x,d.y-c.y,d.z-c.z),h=vec3.create(),i=vec3.create();vec3.cross(h,e,f),vec3.cross(i,f,g);var j=vec3.dot(e,i)*vec3.length(f),k=vec3.dot(h,i);return Math.atan2(j,k)/Math.PI*180}var c=0,d=0,e=[],f={N:0,CA:1,C:2},g=0,h=0,i=" ",j=void 0;for(var k in this.atoms)if(this.atoms[k].chain!=i&&(" "!=i&&(this.atoms[c].phi=j,this.atoms[c].psi=void 0),j=void 0,h=this.atoms[k].groupID,i=this.atoms[k].chain,g=0),this.atoms[k].chain==i&&this.atoms[k].groupID>=h&&this.atoms[k].groupID<=h+1&&("N"===this.atoms[k].name||"CA"===this.atoms[k].name||"C"===this.atoms[k].name)){var l=3*(this.atoms[k].groupID-h)+f[this.atoms[k].name];1==l?c=k:4==l&&(d=k),e[l]=this.atoms[k],g++}else if(6==g){var m=a(e);this.atoms[c].phi=j,this.atoms[c].psi=m[1],j=m[0],h=e[g-1].groupID,c=d,e[0]=e[3],e[1]=e[4],e[2]=e[5],g=3}this.atoms[c].phi=j,this.atoms[c].psi=void 0},Molecule.prototype.calcBonds=function(){new BondCalculator(this)},Molecule.prototype.toString=function(){var a="{\n";for(var b in this.atoms)a+="{",a+="type: '"+this.atoms[b].type+"', serial: "+this.atoms[b].serial+", name: '"+this.atoms[b].name+"', struct:'"+this.atoms[b].struct+"', x :"+this.atoms[b].x+", y :"+this.atoms[b].y+", z :"+this.atoms[b].z+", symbol:'"+this.atoms[b].symbol+"'},\n ";return a+="center: {"+this.cg.x+",y: "+this.cg.y+",z: "+this.cg.z+"} } ",a+="}\n"};